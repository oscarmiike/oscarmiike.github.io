<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AinslieAPI: retry</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AinslieAPI
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">retry</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md4428"></a> Abstraction for exponential and custom retry strategies for failed operations.</p>
<h1><a class="anchor" id="autotoc_md4429"></a>
Installation</h1>
<pre class="fragment">npm install retry
</pre> <h1><a class="anchor" id="autotoc_md4430"></a>
Current Status</h1>
<p>This module has been tested and is ready to be used.</p>
<h1><a class="anchor" id="autotoc_md4431"></a>
Tutorial</h1>
<p>The example below will retry a potentially failing <code>dns.resolve</code> operation <code>10</code> times using an exponential backoff strategy. With the default settings, this means the last attempt is made after <code>17 minutes and 3 seconds</code>.</p>
<div class="fragment"><div class="line"> javascript</div>
<div class="line">var dns = require(&#39;dns&#39;);</div>
<div class="line">var retry = require(&#39;retry&#39;);</div>
<div class="line"> </div>
<div class="line">function faultTolerantResolve(address, cb) {</div>
<div class="line">  var operation = retry.operation();</div>
<div class="line"> </div>
<div class="line">  operation.attempt(function(currentAttempt) {</div>
<div class="line">    dns.resolve(address, function(err, addresses) {</div>
<div class="line">      if (operation.retry(err)) {</div>
<div class="line">        return;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      cb(err ? operation.mainError() : null, addresses);</div>
<div class="line">    });</div>
<div class="line">  });</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">faultTolerantResolve(&#39;nodejs.org&#39;, function(err, addresses) {</div>
<div class="line">  console.log(err, addresses);</div>
<div class="line">});</div>
</div><!-- fragment --><p>Of course you can also configure the factors that go into the exponential backoff. See the API documentation below for all available settings. currentAttempt is an int representing the number of attempts so far.</p>
<div class="fragment"><div class="line"> javascript</div>
<div class="line">var operation = retry.operation({</div>
<div class="line">  retries: 5,</div>
<div class="line">  factor: 3,</div>
<div class="line">  minTimeout: 1 * 1000,</div>
<div class="line">  maxTimeout: 60 * 1000,</div>
<div class="line">  randomize: true,</div>
<div class="line">});</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4432"></a>
API</h1>
<h2><a class="anchor" id="autotoc_md4433"></a>
retry.operation([options])</h2>
<p>Creates a new <code>RetryOperation</code> object. See the <code>retry.timeouts()</code> function below for available <code>options</code>.</p>
<h2><a class="anchor" id="autotoc_md4434"></a>
retry.timeouts([options])</h2>
<p>Returns an array of timeouts. All time <code>options</code> and return values are in milliseconds. If <code>options</code> is an array, a copy of that array is returned.</p>
<p><code>options</code> is a JS object that can contain any of the following keys:</p>
<ul>
<li><code>retries</code>: The maximum amount of times to retry the operation. Default is <code>10</code>.</li>
<li><code>factor</code>: The exponential factor to use. Default is <code>2</code>.</li>
<li><code>minTimeout</code>: The number of milliseconds before starting the first retry. Default is <code>1000</code>.</li>
<li><code>maxTimeout</code>: The maximum number of milliseconds between two retries. Default is <code>Infinity</code>.</li>
<li><code>randomize</code>: Randomizes the timeouts by multiplying with a factor between <code>1</code> to <code>2</code>. Default is <code>false</code>.</li>
</ul>
<p>The formula used to calculate the individual timeouts is:</p>
<div class="fragment"><div class="line">var Math.min(random * minTimeout * Math.pow(factor, attempt), maxTimeout);</div>
</div><!-- fragment --><p>Have a look at <a href="http://dthain.blogspot.com/2009/02/exponential-backoff-in-distributed.html">this article</a> for a better explanation of approach.</p>
<p>If you want to tune your <code>factor</code> / <code>times</code> settings to attempt the last retry after a certain amount of time, you can use wolfram alpha. For example in order to tune for <code>10</code> attempts in <code>5 minutes</code>, you can use this equation:</p>
<p><img src="https://github.com/tim-kos/node-retry/raw/master/equation.gif" alt="screenshot" class="inline"/></p>
<p>Explaining the various values from left to right:</p>
<ul>
<li><code>k = 0 ... 9</code>: The <code>retries</code> value (10)</li>
<li><code>1000</code>: The <code>minTimeout</code> value in ms (1000)</li>
<li><code>x^k</code>: No need to change this, <code>x</code> will be your resulting factor</li>
<li><code>5 * 60 * 1000</code>: The desired total amount of time for retrying in ms (5 minutes)</li>
</ul>
<p>To make this a little easier for you, use wolfram alpha to do the calculations:</p>
<p>[<a href="http://www.wolframalpha.com/input/?i=Sum%5B1000">http://www.wolframalpha.com/input/?i=Sum%5B1000</a>*x^k%2C+{k%2C+0%2C+9}%5D+%3D+5+*+60+*+1000]()</p>
<h2><a class="anchor" id="autotoc_md4435"></a>
new RetryOperation(timeouts)</h2>
<p>Creates a new <code>RetryOperation</code> where <code>timeouts</code> is an array where each value is a timeout given in milliseconds.</p>
<h3><a class="anchor" id="autotoc_md4436"></a>
retryOperation.errors()</h3>
<p>Returns an array of all errors that have been passed to <code>retryOperation.retry()</code> so far.</p>
<h3><a class="anchor" id="autotoc_md4437"></a>
retryOperation.mainError()</h3>
<p>A reference to the error object that occured most frequently. Errors are compared using the <code>error.message</code> property.</p>
<p>If multiple error messages occured the same amount of time, the last error object with that message is returned.</p>
<p>If no errors occured so far, the value is <code>null</code>.</p>
<h3><a class="anchor" id="autotoc_md4438"></a>
retryOperation.attempt(fn, timeoutOps)</h3>
<p>Defines the function <code>fn</code> that is to be retried and executes it for the first time right away. The <code>fn</code> function can receive an optional <code>currentAttempt</code> callback that represents the number of attempts to execute <code>fn</code> so far.</p>
<p>Optionally defines <code>timeoutOps</code> which is an object having a property <code>timeout</code> in miliseconds and a property <code>cb</code> callback function. Whenever your retry operation takes longer than <code>timeout</code> to execute, the timeout callback function <code>cb</code> is called.</p>
<h3><a class="anchor" id="autotoc_md4439"></a>
retryOperation.try(fn)</h3>
<p>This is an alias for <code>retryOperation.attempt(fn)</code>. This is deprecated.</p>
<h3><a class="anchor" id="autotoc_md4440"></a>
retryOperation.start(fn)</h3>
<p>This is an alias for <code>retryOperation.attempt(fn)</code>. This is deprecated.</p>
<h3><a class="anchor" id="autotoc_md4441"></a>
retryOperation.retry(error)</h3>
<p>Returns <code>false</code> when no <code>error</code> value is given, or the maximum amount of retries has been reached.</p>
<p>Otherwise it returns <code>true</code>, and retries the operation after the timeout for the current attempt number.</p>
<h3><a class="anchor" id="autotoc_md4442"></a>
retryOperation.attempts()</h3>
<p>Returns an int representing the number of attempts it took to call <code>fn</code> before it was successful.</p>
<h1><a class="anchor" id="autotoc_md4443"></a>
License</h1>
<p>retry is licensed under the MIT license.</p>
<p>#Changelog</p>
<p>0.6.0 Introduced optional timeOps parameter for the attempt() function which is an object having a property timeout in miliseconds and a property cb callback function. Whenever your retry operation takes longer than timeout to execute, the timeout callback function cb is called.</p>
<p>0.5.0 Some minor refactorings.</p>
<p>0.4.0 Changed retryOperation.try() to retryOperation.attempt(). Deprecated the aliases start() and try() for it.</p>
<p>0.3.0 Added retryOperation.start() which is an alias for retryOperation.try().</p>
<p>0.2.0 Added attempts() function and parameter to retryOperation.try() representing the number of attempts it took to call fn(). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
