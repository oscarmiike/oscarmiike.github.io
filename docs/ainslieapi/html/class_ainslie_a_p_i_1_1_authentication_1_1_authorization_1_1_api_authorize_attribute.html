<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AinslieAPI: AinslieAPI.Authentication.Authorization.ApiAuthorizeAttribute Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AinslieAPI
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('class_ainslie_a_p_i_1_1_authentication_1_1_authorization_1_1_api_authorize_attribute.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="class_ainslie_a_p_i_1_1_authentication_1_1_authorization_1_1_api_authorize_attribute-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">AinslieAPI.Authentication.Authorization.ApiAuthorizeAttribute Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Custom authorization attribute to enforce API access control based on user roles.  
 <a href="#details">More...</a></p>
<div class="dynheader">
Inheritance diagram for AinslieAPI.Authentication.Authorization.ApiAuthorizeAttribute:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_ainslie_a_p_i_1_1_authentication_1_1_authorization_1_1_api_authorize_attribute__inherit__graph.svg" width="251" height="128"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for AinslieAPI.Authentication.Authorization.ApiAuthorizeAttribute:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_ainslie_a_p_i_1_1_authentication_1_1_authorization_1_1_api_authorize_attribute__coll__graph.svg" width="251" height="128"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ab556c47c48998eacd84d3d00c8cc67e3" id="r_ab556c47c48998eacd84d3d00c8cc67e3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab556c47c48998eacd84d3d00c8cc67e3">ApiAuthorizeAttribute</a> ()</td></tr>
<tr class="memdesc:ab556c47c48998eacd84d3d00c8cc67e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes a new instance of ApiAuthorizeAttribute with no roles specified.  <br /></td></tr>
<tr class="separator:ab556c47c48998eacd84d3d00c8cc67e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a742cbf3356588eff30118d3f1ea7b75a" id="r_a742cbf3356588eff30118d3f1ea7b75a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a742cbf3356588eff30118d3f1ea7b75a">ApiAuthorizeAttribute</a> (string roles)</td></tr>
<tr class="memdesc:a742cbf3356588eff30118d3f1ea7b75a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes a new instance of ApiAuthorizeAttribute, specifying required roles.  <br /></td></tr>
<tr class="separator:a742cbf3356588eff30118d3f1ea7b75a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b1fdfb6a2c2c0549e48a267b3aa1750" id="r_a4b1fdfb6a2c2c0549e48a267b3aa1750"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4b1fdfb6a2c2c0549e48a267b3aa1750">OnAuthorization</a> (AuthorizationFilterContext context)</td></tr>
<tr class="memdesc:a4b1fdfb6a2c2c0549e48a267b3aa1750"><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes the authorization check when an action is being accessed.  <br /></td></tr>
<tr class="separator:a4b1fdfb6a2c2c0549e48a267b3aa1750"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:adee859b03894000e15df721af1fcf07b" id="r_adee859b03894000e15df721af1fcf07b"><td class="memItemLeft" align="right" valign="top">readonly List&lt; string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adee859b03894000e15df721af1fcf07b">_requiredRoles</a> = new List&lt;string&gt;()</td></tr>
<tr class="separator:adee859b03894000e15df721af1fcf07b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Custom authorization attribute to enforce API access control based on user roles. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ab556c47c48998eacd84d3d00c8cc67e3" name="ab556c47c48998eacd84d3d00c8cc67e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab556c47c48998eacd84d3d00c8cc67e3">&#9670;&#160;</a></span>ApiAuthorizeAttribute() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">AinslieAPI.Authentication.Authorization.ApiAuthorizeAttribute.ApiAuthorizeAttribute </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initializes a new instance of ApiAuthorizeAttribute with no roles specified. </p>
<div class="fragment"><div class="line"><span class="lineno">   26</span>    {</div>
<div class="line"><span class="lineno">   27</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a742cbf3356588eff30118d3f1ea7b75a" name="a742cbf3356588eff30118d3f1ea7b75a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a742cbf3356588eff30118d3f1ea7b75a">&#9670;&#160;</a></span>ApiAuthorizeAttribute() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">AinslieAPI.Authentication.Authorization.ApiAuthorizeAttribute.ApiAuthorizeAttribute </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>roles</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initializes a new instance of ApiAuthorizeAttribute, specifying required roles. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">roles</td><td>A comma-separated list of roles that are allowed access.</td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><span class="lineno">   34</span>    {</div>
<div class="line"><span class="lineno">   35</span>        <a class="code hl_variable" href="#adee859b03894000e15df721af1fcf07b">_requiredRoles</a> = roles.Split(<span class="stringliteral">&quot;,&quot;</span>).Select(role =&gt; role.Trim()).ToList();</div>
<div class="line"><span class="lineno">   36</span>    }</div>
<div class="ttc" id="aclass_ainslie_a_p_i_1_1_authentication_1_1_authorization_1_1_api_authorize_attribute_html_adee859b03894000e15df721af1fcf07b"><div class="ttname"><a href="#adee859b03894000e15df721af1fcf07b">AinslieAPI.Authentication.Authorization.ApiAuthorizeAttribute._requiredRoles</a></div><div class="ttdeci">readonly List&lt; string &gt; _requiredRoles</div><div class="ttdef"><b>Definition</b> ApiAuthorizeAttribute.cs:20</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a4b1fdfb6a2c2c0549e48a267b3aa1750" name="a4b1fdfb6a2c2c0549e48a267b3aa1750"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b1fdfb6a2c2c0549e48a267b3aa1750">&#9670;&#160;</a></span>OnAuthorization()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void AinslieAPI.Authentication.Authorization.ApiAuthorizeAttribute.OnAuthorization </td>
          <td>(</td>
          <td class="paramtype">AuthorizationFilterContext</td>          <td class="paramname"><span class="paramname"><em>context</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Executes the authorization check when an action is being accessed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>The AuthorizationFilterContext for the current request.</td></tr>
  </table>
  </dd>
</dl>
<p>Skips authorization if the action is decorated with the AllowAnonymousAttribute. Attempts to authenticate the user via cookies first, then by JWT token. Denies access if the user is not authenticated or does not possess any of the required roles. </p>
<p>user.Roles.Any(userRole =&gt; _requiredRoles.Any(requiredRole =&gt; requiredRole == userRole))))</p>
<div class="fragment"><div class="line"><span class="lineno">   50</span>    {</div>
<div class="line"><span class="lineno">   51</span>        <span class="comment">// skip authorization if action is decorated with [AllowAnonymous] attribute</span></div>
<div class="line"><span class="lineno">   52</span>        var allowAnonymous = context.ActionDescriptor.EndpointMetadata.OfType&lt;AllowAnonymousAttribute&gt;().Any();</div>
<div class="line"><span class="lineno">   53</span>        <span class="keywordflow">if</span> (allowAnonymous)</div>
<div class="line"><span class="lineno">   54</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   55</span>        <span class="comment">// try cookie authenticated user first</span></div>
<div class="line"><span class="lineno">   56</span>        <a class="code hl_class" href="class_ainslie_a_p_i_1_1_d_t_o_1_1_user_helper_1_1_authenticated_user.html">AuthenticatedUser</a>? user = context.HttpContext.User.Identity.IsAuthenticated ? <a class="code hl_class" href="class_ainslie_a_p_i_1_1_helpers_1_1_user_helper.html">UserHelper</a>.<a class="code hl_function" href="class_ainslie_a_p_i_1_1_helpers_1_1_user_helper.html#a5aef940b2585ea4d9472c9f3e89a860f">GetAuthenticatedUser</a>(context.HttpContext.User) : <span class="keyword">null</span>;</div>
<div class="line"><span class="lineno">   57</span>        <span class="keywordflow">if</span> (user == <span class="keyword">null</span>)</div>
<div class="line"><span class="lineno">   58</span>            <span class="comment">// try authenticate via jwt second</span></div>
<div class="line"><span class="lineno">   59</span>            user = (<a class="code hl_class" href="class_ainslie_a_p_i_1_1_d_t_o_1_1_user_helper_1_1_authenticated_user.html">AuthenticatedUser</a>?)context.HttpContext.Items[<span class="stringliteral">&quot;user&quot;</span>];</div>
<div class="line"><span class="lineno">   60</span>        <span class="keywordflow">if</span> (user == <span class="keyword">null</span> || (<a class="code hl_variable" href="#adee859b03894000e15df721af1fcf07b">_requiredRoles</a>.Count &gt; 0 &amp;&amp; !user.<a class="code hl_property" href="class_ainslie_a_p_i_1_1_d_t_o_1_1_user_helper_1_1_authenticated_user.html#a55ecb49775511e5752b250ebad9d7dc5">Roles</a>.Intersect(<a class="code hl_variable" href="#adee859b03894000e15df721af1fcf07b">_requiredRoles</a>).Any())) </div>
<div class="line"><span class="lineno">   61</span>            context.Result = <span class="keyword">new</span> JsonResult(<span class="keyword">new</span> { message = <span class="stringliteral">&quot;Unauthorized&quot;</span> }) { StatusCode = StatusCodes.Status401Unauthorized };</div>
<div class="line"><span class="lineno">   62</span>            <span class="comment">//context.Result = new UnauthorizedResult();</span></div>
<div class="line"><span class="lineno">   63</span>    }</div>
<div class="ttc" id="aclass_ainslie_a_p_i_1_1_d_t_o_1_1_user_helper_1_1_authenticated_user_html"><div class="ttname"><a href="class_ainslie_a_p_i_1_1_d_t_o_1_1_user_helper_1_1_authenticated_user.html">AinslieAPI.DTO.UserHelper.AuthenticatedUser</a></div><div class="ttdef"><b>Definition</b> AuthenticatedUser.cs:6</div></div>
<div class="ttc" id="aclass_ainslie_a_p_i_1_1_d_t_o_1_1_user_helper_1_1_authenticated_user_html_a55ecb49775511e5752b250ebad9d7dc5"><div class="ttname"><a href="class_ainslie_a_p_i_1_1_d_t_o_1_1_user_helper_1_1_authenticated_user.html#a55ecb49775511e5752b250ebad9d7dc5">AinslieAPI.DTO.UserHelper.AuthenticatedUser.Roles</a></div><div class="ttdeci">List&lt; string &gt; Roles</div><div class="ttdef"><b>Definition</b> AuthenticatedUser.cs:9</div></div>
<div class="ttc" id="aclass_ainslie_a_p_i_1_1_helpers_1_1_user_helper_html"><div class="ttname"><a href="class_ainslie_a_p_i_1_1_helpers_1_1_user_helper.html">AinslieAPI.Helpers.UserHelper</a></div><div class="ttdef"><b>Definition</b> UserHelper.cs:9</div></div>
<div class="ttc" id="aclass_ainslie_a_p_i_1_1_helpers_1_1_user_helper_html_a5aef940b2585ea4d9472c9f3e89a860f"><div class="ttname"><a href="class_ainslie_a_p_i_1_1_helpers_1_1_user_helper.html#a5aef940b2585ea4d9472c9f3e89a860f">AinslieAPI.Helpers.UserHelper.GetAuthenticatedUser</a></div><div class="ttdeci">static AuthenticatedUser GetAuthenticatedUser(ClaimsPrincipal user)</div><div class="ttdoc">Extracts and constructs an AuthenticatedUser object from the security claims of the currently authent...</div><div class="ttdef"><b>Definition</b> UserHelper.cs:22</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_ainslie_a_p_i_1_1_authentication_1_1_authorization_1_1_api_authorize_attribute_a4b1fdfb6a2c2c0549e48a267b3aa1750_cgraph.svg" width="488" height="70"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="adee859b03894000e15df721af1fcf07b" name="adee859b03894000e15df721af1fcf07b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adee859b03894000e15df721af1fcf07b">&#9670;&#160;</a></span>_requiredRoles</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly List&lt;string&gt; AinslieAPI.Authentication.Authorization.ApiAuthorizeAttribute._requiredRoles = new List&lt;string&gt;()</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>C:/Users/STRIDER/source/repos/AinslieAPI/Authentication/Authorization/<a class="el" href="_api_authorize_attribute_8cs.html">ApiAuthorizeAttribute.cs</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespace_ainslie_a_p_i.html">AinslieAPI</a></li><li class="navelem"><a class="el" href="namespace_ainslie_a_p_i_1_1_authentication.html">Authentication</a></li><li class="navelem"><a class="el" href="namespace_ainslie_a_p_i_1_1_authentication_1_1_authorization.html">Authorization</a></li><li class="navelem"><a class="el" href="class_ainslie_a_p_i_1_1_authentication_1_1_authorization_1_1_api_authorize_attribute.html">ApiAuthorizeAttribute</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
