\chapter{is-\/my-\/json-\/valid}
\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0}{}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0}\index{is-\/my-\/json-\/valid@{is-\/my-\/json-\/valid}}
\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2966}%
\Hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2966}%
 A \href{https://json-schema.org/}{\texttt{ JSONSchema}} validator that uses code generation to be extremely fast.

It passes the entire JSONSchema v4 test suite except for {\ttfamily remote\+Refs} and {\ttfamily max\+Length}/{\ttfamily min\+Length} when using unicode surrogate pairs.

\href{https://travis-ci.org/mafintosh/is-my-json-valid}{\texttt{ }}\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2967}{}\doxysection{\texorpdfstring{Installation}{Installation}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2967}

\begin{DoxyCode}{0}
\DoxyCodeLine{npm\ install\ -\/-\/save\ is-\/my-\/json-\/valid}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2968}{}\doxysection{\texorpdfstring{Usage}{Usage}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2968}
Simply pass a schema to compile it


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ validator\ =\ require('is-\/my-\/json-\/valid')}
\DoxyCodeLine{}
\DoxyCodeLine{var\ validate\ =\ validator(\{}
\DoxyCodeLine{\ \ required:\ true,}
\DoxyCodeLine{\ \ type:\ 'object',}
\DoxyCodeLine{\ \ properties:\ \{}
\DoxyCodeLine{\ \ \ \ hello:\ \{}
\DoxyCodeLine{\ \ \ \ \ \ required:\ true,}
\DoxyCodeLine{\ \ \ \ \ \ type:\ 'string'}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{console.log('should\ be\ valid',\ validate(\{hello:\ 'world'\}))}
\DoxyCodeLine{console.log('should\ not\ be\ valid',\ validate(\{\}))}
\DoxyCodeLine{}
\DoxyCodeLine{//\ get\ the\ last\ list\ of\ errors\ by\ checking\ validate.errors}
\DoxyCodeLine{//\ the\ following\ will\ print\ [\{field:\ 'data.hello',\ message:\ 'is\ required'\}]}
\DoxyCodeLine{console.log(validate.errors)}

\end{DoxyCode}


You can also pass the schema as a string


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ validate\ =\ validator('\{"{}type"{}:\ ...\ \}')}

\end{DoxyCode}


Optionally you can use the require submodule to load a schema from {\ttfamily \+\_\+\+\_\+dirname}


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ validator\ =\ require('is-\/my-\/json-\/valid/require')}
\DoxyCodeLine{var\ validate\ =\ validator('my-\/schema.json')}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2969}{}\doxysection{\texorpdfstring{Custom formats}{Custom formats}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2969}
is-\/my-\/json-\/valid supports the formats specified in JSON schema v4 (such as date-\/time). If you want to add your own custom formats pass them as the formats options to the validator


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ validate\ =\ validator(\{}
\DoxyCodeLine{\ \ type:\ 'string',}
\DoxyCodeLine{\ \ required:\ true,}
\DoxyCodeLine{\ \ format:\ 'only-\/a'}
\DoxyCodeLine{\},\ \{}
\DoxyCodeLine{\ \ formats:\ \{}
\DoxyCodeLine{\ \ \ \ 'only-\/a':\ /\string^a+\$/}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{console.log(validate('aa'))\ //\ true}
\DoxyCodeLine{console.log(validate('ab'))\ //\ false}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2970}{}\doxysection{\texorpdfstring{External schemas}{External schemas}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2970}
You can pass in external schemas that you reference using the {\ttfamily \$ref} attribute as the {\ttfamily schemas} option


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ ext\ =\ \{}
\DoxyCodeLine{\ \ required:\ true,}
\DoxyCodeLine{\ \ type:\ 'string'}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{var\ schema\ =\ \{}
\DoxyCodeLine{\ \ \$ref:\ '\#ext'\ //\ references\ another\ schema\ called\ ext}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{//\ pass\ the\ external\ schemas\ as\ an\ option}
\DoxyCodeLine{var\ validate\ =\ validator(schema,\ \{schemas:\ \{ext:\ ext\}\})}
\DoxyCodeLine{}
\DoxyCodeLine{validate('hello')\ //\ returns\ true}
\DoxyCodeLine{validate(42)\ //\ return\ false}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2971}{}\doxysection{\texorpdfstring{Filtering away additional properties}{Filtering away additional properties}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2971}
is-\/my-\/json-\/valid supports filtering away properties not in the schema


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ filter\ =\ validator.filter(\{}
\DoxyCodeLine{\ \ required:\ true,}
\DoxyCodeLine{\ \ type:\ 'object',}
\DoxyCodeLine{\ \ properties:\ \{}
\DoxyCodeLine{\ \ \ \ hello:\ \{type:\ 'string',\ required:\ true\}}
\DoxyCodeLine{\ \ \},}
\DoxyCodeLine{\ \ additionalProperties:\ false}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{var\ doc\ =\ \{hello:\ 'world',\ notInSchema:\ true\}}
\DoxyCodeLine{console.log(filter(doc))\ //\ \{hello:\ 'world'\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2972}{}\doxysection{\texorpdfstring{Verbose mode shows more information about the source of the error}{Verbose mode shows more information about the source of the error}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2972}
When the {\ttfamily verbose} options is set to {\ttfamily true}, {\ttfamily is-\/my-\/json-\/valid} also outputs\+:


\begin{DoxyItemize}
\item {\ttfamily value}\+: The data value that caused the error
\item {\ttfamily schema\+Path}\+: an array of keys indicating which sub-\/schema failed
\end{DoxyItemize}


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ schema\ =\ \{}
\DoxyCodeLine{\ \ required:\ true,}
\DoxyCodeLine{\ \ type:\ 'object',}
\DoxyCodeLine{\ \ properties:\ \{}
\DoxyCodeLine{\ \ \ \ hello:\ \{}
\DoxyCodeLine{\ \ \ \ \ \ required:\ true,}
\DoxyCodeLine{\ \ \ \ \ \ type:\ 'string'}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{var\ validate\ =\ validator(schema,\ \{}
\DoxyCodeLine{\ \ verbose:\ true}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{validate(\{hello:\ 100\});}
\DoxyCodeLine{console.log(validate.errors)}
\DoxyCodeLine{//\ [\ \{\ field:\ 'data.hello',}
\DoxyCodeLine{//\ \ \ \ \ message:\ 'is\ the\ wrong\ type',}
\DoxyCodeLine{//\ \ \ \ \ value:\ 100,}
\DoxyCodeLine{//\ \ \ \ \ type:\ 'string',}
\DoxyCodeLine{//\ \ \ \ \ schemaPath:\ [\ 'properties',\ 'hello'\ ]\ \}\ ]}

\end{DoxyCode}


Many popular libraries make it easy to retrieve the failing rule with the {\ttfamily schema\+Path}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ schemaPath\ =\ validate.errors[0].schemaPath}
\DoxyCodeLine{var\ R\ =\ require('ramda')}
\DoxyCodeLine{}
\DoxyCodeLine{console.log(\ 'All\ evaluate\ to\ the\ same\ thing:\ ',\ R.equals(}
\DoxyCodeLine{\ \ schema.properties.hello,}
\DoxyCodeLine{\ \ \{\ required:\ true,\ type:\ 'string'\ \},}
\DoxyCodeLine{\ \ R.path(schemaPath,\ schema),}
\DoxyCodeLine{\ \ require('lodash').get(schema,\ schemaPath),}
\DoxyCodeLine{\ \ require('jsonpointer').get(schema,\ ["{}"{}].concat(schemaPath))}
\DoxyCodeLine{))}
\DoxyCodeLine{//\ All\ evaluate\ to\ the\ same\ thing:\ true}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2973}{}\doxysection{\texorpdfstring{Greedy mode tries to validate as much as possible}{Greedy mode tries to validate as much as possible}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2973}
By default is-\/my-\/json-\/valid bails on first validation error but when greedy is set to true it tries to validate as much as possible\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ validate\ =\ validator(\{}
\DoxyCodeLine{\ \ type:\ 'object',}
\DoxyCodeLine{\ \ properties:\ \{}
\DoxyCodeLine{\ \ \ \ x:\ \{}
\DoxyCodeLine{\ \ \ \ \ \ type:\ 'number'}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \},}
\DoxyCodeLine{\ \ required:\ ['x',\ 'y']}
\DoxyCodeLine{\},\ \{}
\DoxyCodeLine{\ \ greedy:\ true}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{validate(\{x:\ 'string'\});}
\DoxyCodeLine{console.log(validate.errors)\ //\ [\{field:\ 'data.y',\ message:\ 'is\ required'\},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ //\ \ \{field:\ 'data.x',\ message:\ 'is\ the\ wrong\ type'\}]}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2974}{}\doxysection{\texorpdfstring{Error messages}{Error messages}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2974}
Here is a list of possible {\ttfamily message} values for errors\+:


\begin{DoxyItemize}
\item {\ttfamily is required}
\item {\ttfamily is the wrong type}
\item {\ttfamily has additional items}
\item {\ttfamily must be FORMAT format} (FORMAT is the {\ttfamily format} property from the schema)
\item {\ttfamily must be unique}
\item {\ttfamily must be an enum value}
\item {\ttfamily dependencies not set}
\item {\ttfamily has additional properties}
\item {\ttfamily referenced schema does not match}
\item {\ttfamily negative schema matches}
\item {\ttfamily pattern mismatch}
\item {\ttfamily no schemas match}
\item {\ttfamily no (or more than one) schemas match}
\item {\ttfamily has a remainder}
\item {\ttfamily has more properties than allowed}
\item {\ttfamily has less properties than allowed}
\item {\ttfamily has more items than allowed}
\item {\ttfamily has less items than allowed}
\item {\ttfamily has longer length than allowed}
\item {\ttfamily has less length than allowed}
\item {\ttfamily is less than minimum}
\item {\ttfamily is more than maximum}
\end{DoxyItemize}\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2975}{}\doxysection{\texorpdfstring{Performance}{Performance}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2975}
is-\/my-\/json-\/valid uses code generation to turn your JSON schema into basic javascript code that is easily optimizeable by v8.

At the time of writing, is-\/my-\/json-\/valid is the {\bfseries{fastest validator}} when running


\begin{DoxyItemize}
\item \href{https://github.com/Muscula/json-schema-benchmark}{\texttt{ json-\/schema-\/benchmark}}
\item \href{http://cosmicrealms.com/blog/2014/08/29/benchmark-of-node-dot-js-json-validation-modules-part-3/}{\texttt{ cosmicreals.\+com benchmark}}
\item \href{https://github.com/pandastrike/jsck/issues/72\#issuecomment-70992684}{\texttt{ jsck benchmark}}
\item \href{https://cdn.rawgit.com/playlyfe/themis/master/benchmark/results.html}{\texttt{ themis benchmark}}
\item \href{https://rawgit.com/zaggino/z-schema/master/benchmark/results.html}{\texttt{ z-\/schema benchmark}}
\end{DoxyItemize}

If you know any other relevant benchmarks open a PR and I\textquotesingle{}ll add them.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2976}{}\doxysection{\texorpdfstring{Type\+Script support}{Type\+Script support}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2976}
This library ships with Type\+Script typings. They are still early on and not perfect at the moment, but should hopefully handle the most common cases. If you find anything that doesn\textquotesingle{}t work, please open an issue and we\textquotesingle{}ll try to solve it.

The typings are using {\ttfamily unknown} and thus require Type\+Script 3.\+0 or later.

Here is a quick sample of usage together with express\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ createError\ =\ require('http-\/errors')}
\DoxyCodeLine{import\ createValidator\ =\ require('is-\/my-\/json-\/valid')}
\DoxyCodeLine{import\ \{\ Request,\ Response,\ NextFunction\ \}\ from\ 'express'}
\DoxyCodeLine{}
\DoxyCodeLine{const\ personValidator\ =\ createValidator(\{}
\DoxyCodeLine{\ \ type:\ 'object',}
\DoxyCodeLine{\ \ properties:\ \{}
\DoxyCodeLine{\ \ \ \ name:\ \{\ type:\ 'string'\ \},}
\DoxyCodeLine{\ \ \ \ age:\ \{\ type:\ 'number'\ \},}
\DoxyCodeLine{\ \ \},}
\DoxyCodeLine{\ \ required:\ [}
\DoxyCodeLine{\ \ \ \ 'name'}
\DoxyCodeLine{\ \ ]}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{export\ function\ post\ (req:\ Request,\ res:\ Response,\ next:\ NextFunction)\ \{}
\DoxyCodeLine{\ \ //\ Here\ req.body\ is\ typed\ as:\ any}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ if\ (!personValidator(req.body))\ \{}
\DoxyCodeLine{\ \ \ \ throw\ createError(400,\ \{\ errors:\ personValidator.errors\ \})}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ //\ Here\ req.body\ is\ typed\ as:\ \{\ name:\ string,\ age:\ number\ |\ undefined\ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}


As you can see, the typings for is-\/my-\/json-\/valid will contruct an interface from the schema passed in. This allows you to work with your incoming json body in a type safe way.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2977}{}\doxysection{\texorpdfstring{License}{License}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2cff18e5dcca4462d29c657c841560fe0_autotoc_md2977}
MIT 