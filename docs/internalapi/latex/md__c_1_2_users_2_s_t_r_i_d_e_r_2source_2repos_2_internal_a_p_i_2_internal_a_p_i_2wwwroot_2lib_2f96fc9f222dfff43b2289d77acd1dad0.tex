\chapter{README}
\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0}{}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0}\index{README@{README}}


 {\bfseries{Hawk}} is an HTTP authentication scheme using a message authentication code (MAC) algorithm to provide partial HTTP request cryptographic verification. For more complex use cases such as access delegation, see \href{https://github.com/hueniverse/oz}{\texttt{ Oz}}.

Current version\+: {\bfseries{3.\+x}}

Note\+: 3.\+x and 2.\+x are the same exact protocol as 1.\+1. The version increments reflect changes in the node API.

\href{http://travis-ci.org/hueniverse/hawk}{\texttt{ }}\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2671}{}\doxysection{\texorpdfstring{Table of Content}{Table of Content}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2671}

\begin{DoxyItemize}
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\+Introduction\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}
\begin{DoxyItemize}
\item Replay Protection
\item Usage Example
\item Protocol Example
\begin{DoxyItemize}
\item Payload Validation
\item Response Payload Validation
\end{DoxyItemize}
\item Browser Support and Considerations 
\end{DoxyItemize}
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\+Single URI Authorization\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}
\begin{DoxyItemize}
\item Usage Example 
\end{DoxyItemize}
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\+Security Considerations\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}
\begin{DoxyItemize}
\item MAC Keys Transmission
\item Confidentiality of Requests
\item Spoofing by Counterfeit Servers
\item Plaintext Storage of Credentials
\item Entropy of Keys
\item Coverage Limitations
\item Future Time Manipulation
\item Client Clock Poisoning
\item Bewit Limitations
\item Host Header Forgery 
\end{DoxyItemize}
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\+Frequently Asked Questions\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} 
\end{DoxyItemize}


\begin{DoxyItemize}
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\+Implementations\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\+Acknowledgements\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}
\end{DoxyItemize}\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2672}{}\doxysection{\texorpdfstring{Introduction}{Introduction}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2672}
{\bfseries{Hawk}} is an HTTP authentication scheme providing mechanisms for making authenticated HTTP requests with partial cryptographic verification of the request and response, covering the HTTP method, request URI, host, and optionally the request payload.

Similar to the HTTP \href{http://www.ietf.org/rfc/rfc2617.txt}{\texttt{ Digest access authentication schemes}}, {\bfseries{Hawk}} uses a set of client credentials which include an identifier (e.\+g. username) and key (e.\+g. password). Likewise, just as with the Digest scheme, the key is never included in authenticated requests. Instead, it is used to calculate a request MAC value which is included in its place.

However, {\bfseries{Hawk}} has several differences from Digest. In particular, while both use a nonce to limit the possibility of replay attacks, in {\bfseries{Hawk}} the client generates the nonce and uses it in combination with a timestamp, leading to less "{}chattiness"{} (interaction with the server).

Also unlike Digest, this scheme is not intended to protect the key itself (the password in Digest) because the client and server must both have access to the key material in the clear.

The primary design goals of this scheme are to\+:
\begin{DoxyItemize}
\item simplify and improve HTTP authentication for services that are unwilling or unable to deploy TLS for all resources,
\item secure credentials against leakage (e.\+g., when the client uses some form of dynamic configuration to determine where to send an authenticated request), and
\item avoid the exposure of credentials sent to a malicious server over an unauthenticated secure channel due to client failure to validate the server\textquotesingle{}s identity as part of its TLS handshake.
\end{DoxyItemize}

In addition, {\bfseries{Hawk}} supports a method for granting third-\/parties temporary access to individual resources using a query parameter called {\itshape bewit} (in falconry, a leather strap used to attach a tracking device to the leg of a hawk).

The {\bfseries{Hawk}} scheme requires the establishment of a shared symmetric key between the client and the server, which is beyond the scope of this module. Typically, the shared credentials are established via an initial TLS-\/protected phase or derived from some other shared confidential information available to both the client and the server.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2673}{}\doxysubsection{\texorpdfstring{Replay Protection}{Replay Protection}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2673}
Without replay protection, an attacker can use a compromised (but otherwise valid and authenticated) request more than once, gaining access to a protected resource. To mitigate this, clients include both a nonce and a timestamp when making requests. This gives the server enough information to prevent replay attacks.

The nonce is generated by the client, and is a string unique across all requests with the same timestamp and key identifier combination.

The timestamp enables the server to restrict the validity period of the credentials where requests occuring afterwards are rejected. It also removes the need for the server to retain an unbounded number of nonce values for future checks. By default, {\bfseries{Hawk}} uses a time window of 1 minute to allow for time skew between the client and server (which in practice translates to a maximum of 2 minutes as the skew can be positive or negative).

Using a timestamp requires the client\textquotesingle{}s clock to be in sync with the server\textquotesingle{}s clock. {\bfseries{Hawk}} requires both the client clock and the server clock to use NTP to ensure synchronization. However, given the limitations of some client types (e.\+g. browsers) to deploy NTP, the server provides the client with its current time (in seconds precision) in response to a bad timestamp.

There is no expectation that the client will adjust its system clock to match the server (in fact, this would be a potential attack vector). Instead, the client only uses the server\textquotesingle{}s time to calculate an offset used only for communications with that particular server. The protocol rewards clients with synchronized clocks by reducing the number of round trips required to authenticate the first request.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2674}{}\doxysubsection{\texorpdfstring{Usage Example}{Usage Example}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2674}
Server code\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ Http\ =\ require('http');}
\DoxyCodeLine{var\ Hawk\ =\ require('hawk');}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Credentials\ lookup\ function}
\DoxyCodeLine{}
\DoxyCodeLine{var\ credentialsFunc\ =\ function\ (id,\ callback)\ \{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ var\ credentials\ =\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ key:\ 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',}
\DoxyCodeLine{\ \ \ \ \ \ \ \ algorithm:\ 'sha256',}
\DoxyCodeLine{\ \ \ \ \ \ \ \ user:\ 'Steve'}
\DoxyCodeLine{\ \ \ \ \};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ return\ callback(null,\ credentials);}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Create\ HTTP\ server}
\DoxyCodeLine{}
\DoxyCodeLine{var\ handler\ =\ function\ (req,\ res)\ \{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ //\ Authenticate\ incoming\ request}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ Hawk.server.authenticate(req,\ credentialsFunc,\ \{\},\ function\ (err,\ credentials,\ artifacts)\ \{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ //\ Prepare\ response}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ payload\ =\ (!err\ ?\ 'Hello\ '\ +\ credentials.user\ +\ '\ '\ +\ artifacts.ext\ :\ 'Shoosh!');}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ headers\ =\ \{\ 'Content-\/Type':\ 'text/plain'\ \};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ //\ Generate\ Server-\/Authorization\ response\ header}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ header\ =\ Hawk.server.header(credentials,\ artifacts,\ \{\ payload:\ payload,\ contentType:\ headers['Content-\/Type']\ \});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ headers['Server-\/Authorization']\ =\ header;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ //\ Send\ the\ response\ back}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ res.writeHead(!err\ ?\ 200\ :\ 401,\ headers);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ res.end(payload);}
\DoxyCodeLine{\ \ \ \ \});}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Start\ server}
\DoxyCodeLine{}
\DoxyCodeLine{Http.createServer(handler).listen(8000,\ 'example.com');}

\end{DoxyCode}


Client code\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ Request\ =\ require('request');}
\DoxyCodeLine{var\ Hawk\ =\ require('hawk');}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Client\ credentials}
\DoxyCodeLine{}
\DoxyCodeLine{var\ credentials\ =\ \{}
\DoxyCodeLine{\ \ \ \ id:\ 'dh37fgj492je',}
\DoxyCodeLine{\ \ \ \ key:\ 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',}
\DoxyCodeLine{\ \ \ \ algorithm:\ 'sha256'}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Request\ options}
\DoxyCodeLine{}
\DoxyCodeLine{var\ requestOptions\ =\ \{}
\DoxyCodeLine{\ \ \ \ uri:\ 'http://example.com:8000/resource/1?b=1\&a=2',}
\DoxyCodeLine{\ \ \ \ method:\ 'GET',}
\DoxyCodeLine{\ \ \ \ headers:\ \{\}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Generate\ Authorization\ request\ header}
\DoxyCodeLine{}
\DoxyCodeLine{var\ header\ =\ Hawk.client.header('http://example.com:8000/resource/1?b=1\&a=2',\ 'GET',\ \{\ credentials:\ credentials,\ ext:\ 'some-\/app-\/data'\ \});}
\DoxyCodeLine{requestOptions.headers.Authorization\ =\ header.field;}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Send\ authenticated\ request}
\DoxyCodeLine{}
\DoxyCodeLine{Request(requestOptions,\ function\ (error,\ response,\ body)\ \{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ //\ Authenticate\ the\ server's\ response}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ var\ isValid\ =\ Hawk.client.authenticate(response,\ credentials,\ header.artifacts,\ \{\ payload:\ body\ \});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ //\ Output\ results}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ console.log(response.statusCode\ +\ ':\ '\ +\ body\ +\ (isValid\ ?\ '\ (valid)'\ :\ '\ (invalid)'));}
\DoxyCodeLine{\});}

\end{DoxyCode}


{\bfseries{Hawk}} utilized the \href{https://github.com/hueniverse/sntp}{\texttt{ {\bfseries{SNTP}}}} module for time sync management. By default, the local machine time is used. To automatically retrieve and synchronice the clock within the application, use the SNTP \textquotesingle{}start()\textquotesingle{} method.


\begin{DoxyCode}{0}
\DoxyCodeLine{Hawk.sntp.start();}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2675}{}\doxysubsection{\texorpdfstring{Protocol Example}{Protocol Example}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2675}
The client attempts to access a protected resource without authentication, sending the following HTTP request to the resource server\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{GET\ /resource/1?b=1\&a=2\ HTTP/1.1}
\DoxyCodeLine{Host:\ example.com:8000}

\end{DoxyCode}


The resource server returns an authentication challenge.


\begin{DoxyCode}{0}
\DoxyCodeLine{HTTP/1.1\ 401\ Unauthorized}
\DoxyCodeLine{WWW-\/Authenticate:\ Hawk}

\end{DoxyCode}


The client has previously obtained a set of {\bfseries{Hawk}} credentials for accessing resources on the "{}http\+://example.\+com/"{} server. The {\bfseries{Hawk}} credentials issued to the client include the following attributes\+:


\begin{DoxyItemize}
\item Key identifier\+: dh37fgj492je
\item Key\+: werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn
\item Algorithm\+: sha256
\end{DoxyItemize}

The client generates the authentication header by calculating a timestamp (e.\+g. the number of seconds since January 1, 1970 00\+:00\+:00 GMT), generating a nonce, and constructing the normalized request string (each value followed by a newline character)\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{hawk.1.header}
\DoxyCodeLine{1353832234}
\DoxyCodeLine{j4h3g2}
\DoxyCodeLine{GET}
\DoxyCodeLine{/resource/1?b=1\&a=2}
\DoxyCodeLine{example.com}
\DoxyCodeLine{8000}
\DoxyCodeLine{}
\DoxyCodeLine{some-\/app-\/ext-\/data}

\end{DoxyCode}


The request MAC is calculated using HMAC with the specified hash algorithm "{}sha256"{} and the key over the normalized request string. The result is base64-\/encoded to produce the request MAC\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{6R4rV5iE+NPoym+WwjeHzjAGXUtLNIxmo1vpMofpLAE=}

\end{DoxyCode}


The client includes the {\bfseries{Hawk}} key identifier, timestamp, nonce, application specific data, and request MAC with the request using the HTTP {\ttfamily Authorization} request header field\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{GET\ /resource/1?b=1\&a=2\ HTTP/1.1}
\DoxyCodeLine{Host:\ example.com:8000}
\DoxyCodeLine{Authorization:\ Hawk\ id="{}dh37fgj492je"{},\ ts="{}1353832234"{},\ nonce="{}j4h3g2"{},\ ext="{}some-\/app-\/ext-\/data"{},\ mac="{}6R4rV5iE+NPoym+WwjeHzjAGXUtLNIxmo1vpMofpLAE="{}}

\end{DoxyCode}


The server validates the request by calculating the request MAC again based on the request received and verifies the validity and scope of the {\bfseries{Hawk}} credentials. If valid, the server responds with the requested resource.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2676}{}\doxysubsubsection{\texorpdfstring{Payload Validation}{Payload Validation}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2676}
{\bfseries{Hawk}} provides optional payload validation. When generating the authentication header, the client calculates a payload hash using the specified hash algorithm. The hash is calculated over the concatenated value of (each followed by a newline character)\+:
\begin{DoxyItemize}
\item {\ttfamily hawk.\+1.\+payload}
\item the content-\/type in lowercase, without any parameters (e.\+g. {\ttfamily application/json})
\item the request payload prior to any content encoding (the exact representation requirements should be specified by the server for payloads other than simple single-\/part ascii to ensure interoperability)
\end{DoxyItemize}

For example\+:


\begin{DoxyItemize}
\item Payload\+: {\ttfamily Thank you for flying Hawk}
\item Content Type\+: {\ttfamily text/plain}
\item Hash (sha256)\+: {\ttfamily Yi9\+Lf\+IIFRt\+BEPt74\+PVmb\+TF/x\+VAw\+Pn7ub15e\+PICfgnuY=}
\end{DoxyItemize}

Results in the following input to the payload hash function (newline terminated values)\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{hawk.1.payload}
\DoxyCodeLine{text/plain}
\DoxyCodeLine{Thank\ you\ for\ flying\ Hawk}

\end{DoxyCode}


Which produces the following hash value\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Yi9LfIIFRtBEPt74PVmbTF/xVAwPn7ub15ePICfgnuY=}

\end{DoxyCode}


The client constructs the normalized request string (newline terminated values)\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{hawk.1.header}
\DoxyCodeLine{1353832234}
\DoxyCodeLine{j4h3g2}
\DoxyCodeLine{POST}
\DoxyCodeLine{/resource/1?a=1\&b=2}
\DoxyCodeLine{example.com}
\DoxyCodeLine{8000}
\DoxyCodeLine{Yi9LfIIFRtBEPt74PVmbTF/xVAwPn7ub15ePICfgnuY=}
\DoxyCodeLine{some-\/app-\/ext-\/data}

\end{DoxyCode}


Then calculates the request MAC and includes the {\bfseries{Hawk}} key identifier, timestamp, nonce, payload hash, application specific data, and request MAC, with the request using the HTTP {\ttfamily Authorization} request header field\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{POST\ /resource/1?a=1\&b=2\ HTTP/1.1}
\DoxyCodeLine{Host:\ example.com:8000}
\DoxyCodeLine{Authorization:\ Hawk\ id="{}dh37fgj492je"{},\ ts="{}1353832234"{},\ nonce="{}j4h3g2"{},\ hash="{}Yi9LfIIFRtBEPt74PVmbTF/xVAwPn7ub15ePICfgnuY="{},\ ext="{}some-\/app-\/ext-\/data"{},\ mac="{}aSe1DERmZuRl3pI36/9BdZmnErTw3sNzOOAUlfeKjVw="{}}

\end{DoxyCode}


It is up to the server if and when it validates the payload for any given request, based solely on it\textquotesingle{}s security policy and the nature of the data included.

If the payload is available at the time of authentication, the server uses the hash value provided by the client to construct the normalized string and validates the MAC. If the MAC is valid, the server calculates the payload hash and compares the value with the provided payload hash in the header. In many cases, checking the MAC first is faster than calculating the payload hash.

However, if the payload is not available at authentication time (e.\+g. too large to fit in memory, streamed elsewhere, or processed at a different stage in the application), the server may choose to defer payload validation for later by retaining the hash value provided by the client after validating the MAC.

It is important to note that MAC validation does not mean the hash value provided by the client is valid, only that the value included in the header was not modified. Without calculating the payload hash on the server and comparing it to the value provided by the client, the payload may be modified by an attacker.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2677}{}\doxysubsection{\texorpdfstring{Response Payload Validation}{Response Payload Validation}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2677}
{\bfseries{Hawk}} provides partial response payload validation. The server includes the {\ttfamily Server-\/\+Authorization} response header which enables the client to authenticate the response and ensure it is talking to the right server. {\bfseries{Hawk}} defines the HTTP {\ttfamily Server-\/\+Authorization} header as a response header using the exact same syntax as the {\ttfamily Authorization} request header field.

The header is contructed using the same process as the client\textquotesingle{}s request header. The server uses the same credentials and other artifacts provided by the client to constructs the normalized request string. The {\ttfamily ext} and {\ttfamily hash} values are replaced with new values based on the server response. The rest as identical to those used by the client.

The result MAC digest is included with the optional {\ttfamily hash} and {\ttfamily ext} values\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Server-\/Authorization:\ Hawk\ mac="{}XIJRsMl/4oL+nn+vKoeVZPdCHXB4yJkNnBbTbHFZUYE="{},\ hash="{}f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM="{},\ ext="{}response-\/specific"{}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2678}{}\doxysubsection{\texorpdfstring{Browser Support and Considerations}{Browser Support and Considerations}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2678}
A browser script is provided for including using a {\ttfamily \texorpdfstring{$<$}{<}script\texorpdfstring{$>$}{>}} tag in \href{/lib/browser.js}{\texttt{ lib/browser.\+js}}. It\textquotesingle{}s also a \href{http://component.io/hueniverse/hawk}{\texttt{ component}}.

{\bfseries{Hawk}} relies on the {\itshape Server-\/\+Authorization} and {\itshape WWW-\/\+Authenticate} headers in its response to communicate with the client. Therefore, in case of CORS requests, it is important to consider sending {\itshape Access-\/\+Control-\/\+Expose-\/\+Headers} with the value \+\_\+"{}\+WWW-\/\+Authenticate, Server-\/\+Authorization"{}\+\_\+ on each response from your server. As explained in the \href{http://www.w3.org/TR/cors/\#access-control-expose-headers-response-header}{\texttt{ specifications}}, it will indicate that these headers can safely be accessed by the client (using get\+Response\+Header() on the Xml\+Http\+Request object). Otherwise you will be met with a \href{http://www.w3.org/TR/cors/\#simple-response-header}{\texttt{ "{}simple response header"{}}} which excludes these fields and would prevent the Hawk client from authenticating the requests.\+You can read more about the why and how in this \href{http://www.html5rocks.com/en/tutorials/cors/\#toc-adding-cors-support-to-the-server}{\texttt{ article}}\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2679}{}\doxysection{\texorpdfstring{Single URI Authorization}{Single URI Authorization}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2679}
There are cases in which limited and short-\/term access to a protected resource is granted to a third party which does not have access to the shared credentials. For example, displaying a protected image on a web page accessed by anyone. {\bfseries{Hawk}} provides limited support for such URIs in the form of a {\itshape bewit} -\/ a URI query parameter appended to the request URI which contains the necessary credentials to authenticate the request.

Because of the significant security risks involved in issuing such access, bewit usage is purposely limited only to GET requests and for a finite period of time. Both the client and server can issue bewit credentials, however, the server should not use the same credentials as the client to maintain clear traceability as to who issued which credentials.

In order to simplify implementation, bewit credentials do not support single-\/use policy and can be replayed multiple times within the granted access timeframe.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2680}{}\doxysubsection{\texorpdfstring{Bewit Usage Example}{Bewit Usage Example}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2680}
Server code\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ Http\ =\ require('http');}
\DoxyCodeLine{var\ Hawk\ =\ require('hawk');}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Credentials\ lookup\ function}
\DoxyCodeLine{}
\DoxyCodeLine{var\ credentialsFunc\ =\ function\ (id,\ callback)\ \{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ var\ credentials\ =\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ key:\ 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',}
\DoxyCodeLine{\ \ \ \ \ \ \ \ algorithm:\ 'sha256'}
\DoxyCodeLine{\ \ \ \ \};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ return\ callback(null,\ credentials);}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Create\ HTTP\ server}
\DoxyCodeLine{}
\DoxyCodeLine{var\ handler\ =\ function\ (req,\ res)\ \{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ Hawk.uri.authenticate(req,\ credentialsFunc,\ \{\},\ function\ (err,\ credentials,\ attributes)\ \{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ res.writeHead(!err\ ?\ 200\ :\ 401,\ \{\ 'Content-\/Type':\ 'text/plain'\ \});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ res.end(!err\ ?\ 'Access\ granted'\ :\ 'Shoosh!');}
\DoxyCodeLine{\ \ \ \ \});}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{Http.createServer(handler).listen(8000,\ 'example.com');}

\end{DoxyCode}


Bewit code generation\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ Request\ =\ require('request');}
\DoxyCodeLine{var\ Hawk\ =\ require('hawk');}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Client\ credentials}
\DoxyCodeLine{}
\DoxyCodeLine{var\ credentials\ =\ \{}
\DoxyCodeLine{\ \ \ \ id:\ 'dh37fgj492je',}
\DoxyCodeLine{\ \ \ \ key:\ 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',}
\DoxyCodeLine{\ \ \ \ algorithm:\ 'sha256'}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Generate\ bewit}
\DoxyCodeLine{}
\DoxyCodeLine{var\ duration\ =\ 60\ *\ 5;\ \ \ \ \ \ //\ 5\ Minutes}
\DoxyCodeLine{var\ bewit\ =\ Hawk.uri.getBewit('http://example.com:8080/resource/1?b=1\&a=2',\ \{\ credentials:\ credentials,\ ttlSec:\ duration,\ ext:\ 'some-\/app-\/data'\ \});}
\DoxyCodeLine{var\ uri\ =\ 'http://example.com:8000/resource/1?b=1\&a=2'\ +\ '\&bewit='\ +\ bewit;}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2681}{}\doxysection{\texorpdfstring{Security Considerations}{Security Considerations}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2681}
The greatest sources of security risks are usually found not in {\bfseries{Hawk}} but in the policies and procedures surrounding its use. Implementers are strongly encouraged to assess how this module addresses their security requirements. This section includes an incomplete list of security considerations that must be reviewed and understood before deploying {\bfseries{Hawk}} on the server. Many of the protections provided in {\bfseries{Hawk}} depends on whether and how they are used.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2682}{}\doxysubsubsection{\texorpdfstring{MAC Keys Transmission}{MAC Keys Transmission}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2682}
{\bfseries{Hawk}} does not provide any mechanism for obtaining or transmitting the set of shared credentials required. Any mechanism used to obtain {\bfseries{Hawk}} credentials must ensure that these transmissions are protected using transport-\/layer mechanisms such as TLS.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2683}{}\doxysubsubsection{\texorpdfstring{Confidentiality of Requests}{Confidentiality of Requests}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2683}
While {\bfseries{Hawk}} provides a mechanism for verifying the integrity of HTTP requests, it provides no guarantee of request confidentiality. Unless other precautions are taken, eavesdroppers will have full access to the request content. Servers should carefully consider the types of data likely to be sent as part of such requests, and employ transport-\/layer security mechanisms to protect sensitive resources.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2684}{}\doxysubsubsection{\texorpdfstring{Spoofing by Counterfeit Servers}{Spoofing by Counterfeit Servers}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2684}
{\bfseries{Hawk}} provides limited verification of the server authenticity. When receiving a response back from the server, the server may choose to include a response {\ttfamily Server-\/\+Authorization} header which the client can use to verify the response. However, it is up to the server to determine when such measure is included, to up to the client to enforce that policy.

A hostile party could take advantage of this by intercepting the client\textquotesingle{}s requests and returning misleading or otherwise incorrect responses. Service providers should consider such attacks when developing services using this protocol, and should require transport-\/layer security for any requests where the authenticity of the resource server or of server responses is an issue.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2685}{}\doxysubsubsection{\texorpdfstring{Plaintext Storage of Credentials}{Plaintext Storage of Credentials}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2685}
The {\bfseries{Hawk}} key functions the same way passwords do in traditional authentication systems. In order to compute the request MAC, the server must have access to the key in plaintext form. This is in contrast, for example, to modern operating systems, which store only a one-\/way hash of user credentials.

If an attacker were to gain access to these keys -\/ or worse, to the server\textquotesingle{}s database of all such keys -\/ he or she would be able to perform any action on behalf of any resource owner. Accordingly, it is critical that servers protect these keys from unauthorized access.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2686}{}\doxysubsubsection{\texorpdfstring{Entropy of Keys}{Entropy of Keys}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2686}
Unless a transport-\/layer security protocol is used, eavesdroppers will have full access to authenticated requests and request MAC values, and will thus be able to mount offline brute-\/force attacks to recover the key used. Servers should be careful to assign keys which are long enough, and random enough, to resist such attacks for at least the length of time that the {\bfseries{Hawk}} credentials are valid.

For example, if the credentials are valid for two weeks, servers should ensure that it is not possible to mount a brute force attack that recovers the key in less than two weeks. Of course, servers are urged to err on the side of caution, and use the longest key reasonable.

It is equally important that the pseudo-\/random number generator (PRNG) used to generate these keys be of sufficiently high quality. Many PRNG implementations generate number sequences that may appear to be random, but which nevertheless exhibit patterns or other weaknesses which make cryptanalysis or brute force attacks easier. Implementers should be careful to use cryptographically secure PRNGs to avoid these problems.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2687}{}\doxysubsubsection{\texorpdfstring{Coverage Limitations}{Coverage Limitations}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2687}
The request MAC only covers the HTTP {\ttfamily Host} header and optionally the {\ttfamily Content-\/\+Type} header. It does not cover any other headers which can often affect how the request body is interpreted by the server. If the server behavior is influenced by the presence or value of such headers, an attacker can manipulate the request headers without being detected. Implementers should use the {\ttfamily ext} feature to pass application-\/specific information via the {\ttfamily Authorization} header which is protected by the request MAC.

The response authentication, when performed, only covers the response payload, content-\/type, and the request information provided by the client in it\textquotesingle{}s request (method, resource, timestamp, nonce, etc.). It does not cover the HTTP status code or any other response header field (e.\+g. Location) which can affect the client\textquotesingle{}s behaviour.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2688}{}\doxysubsubsection{\texorpdfstring{Future Time Manipulation}{Future Time Manipulation}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2688}
The protocol relies on a clock sync between the client and server. To accomplish this, the server informs the client of its current time when an invalid timestamp is received.

If an attacker is able to manipulate this information and cause the client to use an incorrect time, it would be able to cause the client to generate authenticated requests using time in the future. Such requests will fail when sent by the client, and will not likely leave a trace on the server (given the common implementation of nonce, if at all enforced). The attacker will then be able to replay the request at the correct time without detection.

The client must only use the time information provided by the server if\+:
\begin{DoxyItemize}
\item it was delivered over a TLS connection and the server identity has been verified, or
\item the {\ttfamily tsm} MAC digest calculated using the same client credentials over the timestamp has been verified.
\end{DoxyItemize}\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2689}{}\doxysubsubsection{\texorpdfstring{Client Clock Poisoning}{Client Clock Poisoning}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2689}
When receiving a request with a bad timestamp, the server provides the client with its current time. The client must never use the time received from the server to adjust its own clock, and must only use it to calculate an offset for communicating with that particular server.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2690}{}\doxysubsubsection{\texorpdfstring{Bewit Limitations}{Bewit Limitations}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2690}
Special care must be taken when issuing bewit credentials to third parties. Bewit credentials are valid until expiration and cannot be revoked or limited without using other means. Whatever resource they grant access to will be completely exposed to anyone with access to the bewit credentials which act as bearer credentials for that particular resource. While bewit usage is limited to GET requests only and therefore cannot be used to perform transactions or change server state, it can still be used to expose private and sensitive information.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2691}{}\doxysubsubsection{\texorpdfstring{Host Header Forgery}{Host Header Forgery}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2691}
Hawk validates the incoming request MAC against the incoming HTTP Host header. However, unless the optional {\ttfamily host} and {\ttfamily port} options are used with {\ttfamily server.\+authenticate()}, a malicous client can mint new host names pointing to the server\textquotesingle{}s IP address and use that to craft an attack by sending a valid request that\textquotesingle{}s meant for another hostname than the one used by the server. Server implementors must manually verify that the host header received matches their expectation (or use the options mentioned above).\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2692}{}\doxysection{\texorpdfstring{Frequently Asked Questions}{Frequently Asked Questions}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2692}
\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2693}{}\doxysubsubsection{\texorpdfstring{Where is the protocol specification?}{Where is the protocol specification?}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2693}
If you are looking for some prose explaining how all this works, {\bfseries{this is it}}. {\bfseries{Hawk}} is being developed as an open source project instead of a standard. In other words, the \href{/hueniverse/hawk/tree/master/lib}{\texttt{ code}} is the specification. Not sure about something? Open an issue!\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2694}{}\doxysubsubsection{\texorpdfstring{Is it done?}{Is it done?}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2694}
As of version 0.\+10.\+0, {\bfseries{Hawk}} is feature-\/complete. However, until this module reaches version 1.\+0.\+0 it is considered experimental and is likely to change. This also means your feedback and contribution are very welcome. Feel free to open issues with questions and suggestions.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2695}{}\doxysubsubsection{\texorpdfstring{Where can I find {\bfseries{Hawk}} implementations in other languages?}{Where can I find {\bfseries{Hawk}} implementations in other languages?}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2695}
{\bfseries{Hawk}}\textquotesingle{}s only reference implementation is provided in Java\+Script as a node.\+js module. However, it has been ported to other languages. The full list is maintained \href{https://github.com/hueniverse/hawk/issues?labels=port&state=closed}{\texttt{ here}}. Please add an issue if you are working on another port. A cross-\/platform test-\/suite is in the works.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2696}{}\doxysubsubsection{\texorpdfstring{Why isn\textquotesingle{}t the algorithm part of the challenge or dynamically negotiated?}{Why isn\textquotesingle{}t the algorithm part of the challenge or dynamically negotiated?}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2696}
The algorithm used is closely related to the key issued as different algorithms require different key sizes (and other requirements). While some keys can be used for multiple algorithm, the protocol is designed to closely bind the key and algorithm together as part of the issued credentials.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2697}{}\doxysubsubsection{\texorpdfstring{Why is Host and Content-\/\+Type the only headers covered by the request MAC?}{Why is Host and Content-\/\+Type the only headers covered by the request MAC?}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2697}
It is really hard to include other headers. Headers can be changed by proxies and other intermediaries and there is no well-\/established way to normalize them. Many platforms change the case of header field names and values. The only straight-\/forward solution is to include the headers in some blob (say, base64 encoded JSON) and include that with the request, an approach taken by JWT and other such formats. However, that design violates the HTTP header boundaries, repeats information, and introduces other security issues because firewalls will not be aware of these "{}hidden"{} headers. In addition, any information repeated must be compared to the duplicated information in the header and therefore only moves the problem elsewhere.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2698}{}\doxysubsubsection{\texorpdfstring{Why not just use HTTP Digest?}{Why not just use HTTP Digest?}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2698}
Digest requires pre-\/negotiation to establish a nonce. This means you can\textquotesingle{}t just make a request -\/ you must first send a protocol handshake to the server. This pattern has become unacceptable for most web services, especially mobile where extra round-\/trip are costly.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2699}{}\doxysubsubsection{\texorpdfstring{Why bother with all this nonce and timestamp business?}{Why bother with all this nonce and timestamp business?}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2699}
{\bfseries{Hawk}} is an attempt to find a reasonable, practical compromise between security and usability. OAuth 1.\+0 got timestamp and nonces halfway right but failed when it came to scalability and consistent developer experience. {\bfseries{Hawk}} addresses it by requiring the client to sync its clock, but provides it with tools to accomplish it.

In general, replay protection is a matter of application-\/specific threat model. It is less of an issue on a TLS-\/protected system where the clients are implemented using best practices and are under the control of the server. Instead of dropping replay protection, {\bfseries{Hawk}} offers a required time window and an optional nonce verification. Together, it provides developers with the ability to decide how to enforce their security policy without impacting the client\textquotesingle{}s implementation.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2700}{}\doxysubsubsection{\texorpdfstring{What are {\ttfamily app} and {\ttfamily dlg} in the authorization header and normalized mac string?}{What are {\ttfamily app} and {\ttfamily dlg} in the authorization header and normalized mac string?}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2700}
The original motivation for {\bfseries{Hawk}} was to replace the OAuth 1.\+0 use cases. This included both a simple client-\/server mode which this module is specifically designed for, and a delegated access mode which is being developed separately in \href{https://github.com/hueniverse/oz}{\texttt{ Oz}}. In addition to the {\bfseries{Hawk}} use cases, Oz requires another attribute\+: the application id {\ttfamily app}. This provides binding between the credentials and the application in a way that prevents an attacker from tricking an application to use credentials issued to someone else. It also has an optional \textquotesingle{}delegated-\/by\textquotesingle{} attribute {\ttfamily dlg} which is the application id of the application the credentials were directly issued to. The goal of these two additions is to allow Oz to utilize {\bfseries{Hawk}} directly, but with the additional security of delegated credentials.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2701}{}\doxysubsubsection{\texorpdfstring{What is the purpose of the static strings used in each normalized MAC input?}{What is the purpose of the static strings used in each normalized MAC input?}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2701}
When calculating a hash or MAC, a static prefix (tag) is added. The prefix is used to prevent MAC values from being used or reused for a purpose other than what they were created for (i.\+e. prevents switching MAC values between a request, response, and a bewit use cases). It also protects against exploits created after a potential change in how the protocol creates the normalized string. For example, if a future version would switch the order of nonce and timestamp, it can create an exploit opportunity for cases where the nonce is similar in format to a timestamp.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2702}{}\doxysubsubsection{\texorpdfstring{Does {\bfseries{Hawk}} have anything to do with OAuth?}{Does {\bfseries{Hawk}} have anything to do with OAuth?}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2702}
Short answer\+: no.

{\bfseries{Hawk}} was originally proposed as the OAuth MAC Token specification. However, the OAuth working group in its consistent incompetence failed to produce a final, usable solution to address one of the most popular use cases of OAuth 1.\+0 -\/ using it to authenticate simple client-\/server transactions (i.\+e. two-\/legged). As you can guess, the OAuth working group is still hard at work to produce more garbage.

{\bfseries{Hawk}} provides a simple HTTP authentication scheme for making client-\/server requests. It does not address the OAuth use case of delegating access to a third party. If you are looking for an OAuth alternative, check out \href{https://github.com/hueniverse/oz}{\texttt{ Oz}}.\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2703}{}\doxysection{\texorpdfstring{Implementations}{Implementations}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2703}

\begin{DoxyItemize}
\item \href{https://github.com/logibit/logibit.hawk/}{\texttt{ Logibit Hawk in F\#/.Net}}
\item \href{https://github.com/tent/hawk-ruby}{\texttt{ Tent Hawk in Ruby}}
\item \href{https://github.com/wealdtech/hawk}{\texttt{ Wealdtech in Java}}
\item \href{https://github.com/kumar303/mohawk/}{\texttt{ Kumar\textquotesingle{}s Mohawk in Python}}
\end{DoxyItemize}\hypertarget{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2704}{}\doxysection{\texorpdfstring{Acknowledgements}{Acknowledgements}}\label{md__c_1_2_users_2_s_t_r_i_d_e_r_2source_2repos_2_internal_a_p_i_2_internal_a_p_i_2wwwroot_2lib_2f96fc9f222dfff43b2289d77acd1dad0_autotoc_md2704}
{\bfseries{Hawk}} is a derivative work of the \href{http://tools.ietf.org/html/draft-hammer-oauth-v2-mac-token-05}{\texttt{ HTTP MAC Authentication Scheme}} proposal co-\/authored by Ben Adida, Adam Barth, and Eran Hammer, which in turn was based on the OAuth 1.\+0 community specification.

Special thanks to Ben Laurie for his always insightful feedback and advice.

The {\bfseries{Hawk}} logo was created by \href{http://chriscarrasco.com}{\texttt{ Chris Carrasco}}. 