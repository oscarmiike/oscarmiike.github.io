\doxysection{Task\+API.\+Helpers.\+Spot\+Helper Class Reference}
\hypertarget{class_task_a_p_i_1_1_helpers_1_1_spot_helper}{}\label{class_task_a_p_i_1_1_helpers_1_1_spot_helper}\index{TaskAPI.Helpers.SpotHelper@{TaskAPI.Helpers.SpotHelper}}


Helper class for managing operations related to spot prices.  


\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_spot_helper_ae5d7f0ba6759749953e94555c9557cfb}{Spot\+Helper}} (\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service}{Log\+Service}} log\+Service, \mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_forex_service}{Forex\+Service}} forex\+Service, \mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_alchemy_service}{Alchemy\+Service}} alchemy\+Service, \mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_binance_service}{Binance\+Service}} binance\+Service, IOptions$<$ \mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings}{Task\+APISettings}} $>$ task\+APISettings, \mbox{\hyperlink{class_task_a_p_i_1_1_contexts_1_1_priceapp_context}{Priceapp\+Context}} context, \mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_internal_a_p_i_service}{Internal\+APIService}} iapi\+Service, IWeb\+Host\+Environment env)
\begin{DoxyCompactList}\small\item\em Initialises a new instance of the Spot\+Helper class. \end{DoxyCompactList}\item 
List$<$ \mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_base_spot}{Base\+Spot}} $>$ \mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a7b75f44b3310036d4de7f0f2956bbac1}{Pull\+Save\+Trim}} ()
\begin{DoxyCompactList}\small\item\em Pulls, saves, and trims spot data from various sources. \end{DoxyCompactList}\item 
bool? object Result \mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a6b975ced6fddc4826a8950c8a250b926}{Save\+Daily\+Spot}} ()
\item 
bool \mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a89a665897ed47f9b7065ce771100b83c}{Can\+Sync}} ()
\begin{DoxyCompactList}\small\item\em Determines whether synchronisation with the market is possible based on the current market status. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a1d8458171af3cac5a7fc1fc1f35de115}{Error}}
\begin{DoxyCompactList}\small\item\em Saves daily spot data to the database and exports chart data. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Helper class for managing operations related to spot prices. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{class_task_a_p_i_1_1_helpers_1_1_spot_helper_ae5d7f0ba6759749953e94555c9557cfb}\label{class_task_a_p_i_1_1_helpers_1_1_spot_helper_ae5d7f0ba6759749953e94555c9557cfb} 
\index{TaskAPI.Helpers.SpotHelper@{TaskAPI.Helpers.SpotHelper}!SpotHelper@{SpotHelper}}
\index{SpotHelper@{SpotHelper}!TaskAPI.Helpers.SpotHelper@{TaskAPI.Helpers.SpotHelper}}
\doxysubsubsection{\texorpdfstring{SpotHelper()}{SpotHelper()}}
{\footnotesize\ttfamily Task\+API.\+Helpers.\+Spot\+Helper.\+Spot\+Helper (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service}{Log\+Service}}}]{log\+Service,  }\item[{\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_forex_service}{Forex\+Service}}}]{forex\+Service,  }\item[{\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_alchemy_service}{Alchemy\+Service}}}]{alchemy\+Service,  }\item[{\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_binance_service}{Binance\+Service}}}]{binance\+Service,  }\item[{IOptions$<$ \mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings}{Task\+APISettings}} $>$}]{task\+APISettings,  }\item[{\mbox{\hyperlink{class_task_a_p_i_1_1_contexts_1_1_priceapp_context}{Priceapp\+Context}}}]{context,  }\item[{\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_internal_a_p_i_service}{Internal\+APIService}}}]{iapi\+Service,  }\item[{IWeb\+Host\+Environment}]{env }\end{DoxyParamCaption})}



Initialises a new instance of the Spot\+Helper class. 


\begin{DoxyParams}{Parameters}
{\em log\+Service} & The log service.\\
\hline
{\em forex\+Service} & The forex service.\\
\hline
{\em alchemy\+Service} & The alchemy service.\\
\hline
{\em binance\+Service} & The binance service.\\
\hline
{\em task\+APISettings} & The task API settings.\\
\hline
{\em context} & The priceapp context.\\
\hline
{\em iapi\+Service} & The internal API service.\\
\hline
{\em env} & The hosting environment.\\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00057\ \ \ \ \ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \_alchemyService\ =\ alchemyService;}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \_settings\ =\ taskAPISettings.Value;}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \_logService\ =\ logService;}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \_forexService\ =\ forexService;}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \_binanceService\ =\ binanceService;}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \_context\ =\ context;}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \_iapiService\ =\ iapiService;}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \_env\ =\ env;}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ marketOpen\ =\ IsMarketOpen();}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ marketStatusOverride\ =\ MarketStatusOverride();}
\DoxyCodeLine{00068\ \ \ \ \ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a89a665897ed47f9b7065ce771100b83c}\label{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a89a665897ed47f9b7065ce771100b83c} 
\index{TaskAPI.Helpers.SpotHelper@{TaskAPI.Helpers.SpotHelper}!CanSync@{CanSync}}
\index{CanSync@{CanSync}!TaskAPI.Helpers.SpotHelper@{TaskAPI.Helpers.SpotHelper}}
\doxysubsubsection{\texorpdfstring{CanSync()}{CanSync()}}
{\footnotesize\ttfamily bool Task\+API.\+Helpers.\+Spot\+Helper.\+Can\+Sync (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Determines whether synchronisation with the market is possible based on the current market status. 

\begin{DoxyReturn}{Returns}
{\ttfamily true} if synchronisation is possible; otherwise, {\ttfamily false}.
\end{DoxyReturn}


Returns {\ttfamily false} if the market is forced closed, {\ttfamily true} if forced open, and the current market status if neither forced. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00883\ \ \ \ \ \{}
\DoxyCodeLine{00884\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (marketStatusOverride\ ==\ MarketStatusOverrides.ForceClosed)}
\DoxyCodeLine{00885\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00886\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (marketStatusOverride\ ==\ MarketStatusOverrides.ForceOpen)\ }
\DoxyCodeLine{00887\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00888\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ marketOpen;}
\DoxyCodeLine{00889\ \ \ \ \ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a89a665897ed47f9b7065ce771100b83c_icgraph}
\end{center}
\end{figure}
\Hypertarget{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a7b75f44b3310036d4de7f0f2956bbac1}\label{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a7b75f44b3310036d4de7f0f2956bbac1} 
\index{TaskAPI.Helpers.SpotHelper@{TaskAPI.Helpers.SpotHelper}!PullSaveTrim@{PullSaveTrim}}
\index{PullSaveTrim@{PullSaveTrim}!TaskAPI.Helpers.SpotHelper@{TaskAPI.Helpers.SpotHelper}}
\doxysubsubsection{\texorpdfstring{PullSaveTrim()}{PullSaveTrim()}}
{\footnotesize\ttfamily List$<$ \mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_base_spot}{Base\+Spot}} $>$ Task\+API.\+Helpers.\+Spot\+Helper.\+Pull\+Save\+Trim (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Pulls, saves, and trims spot data from various sources. 

\begin{DoxyReturn}{Returns}
A list of Base\+Spot objects representing spot data after processing. 
\end{DoxyReturn}


This method pulls spot data from multiple sources including forex, Polygon Oracle, Oanda, and Binance.

It groups spot data by asset code and removes redundant entries with zero values.

If necessary, it retrieves the latest AUD price and BTC/\+AUD exchange rate for currency conversion.

USD values are converted to AUD except for AUD itself, and BTC values are converted to AUD using the BTC/\+AUD exchange rate.

It compares metal duplicates against threshold percentages and logs any variations beyond the thresholds.

Redundant/duplicate assets are removed, selecting either the preferred source or the highest price.

Finally, it generates special data, adds the processed spot data to the database, trims the spot data, and returns the final list.
\begin{DoxyCode}{0}
\DoxyCodeLine{00086\ \ \ \ \ \{\ \ \ \ \ \ \ \ }
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ List<BaseSpot>\ finalSpotList\ =\ \textcolor{keyword}{new}\ List<BaseSpot>();}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ var\ pullTime\ =\ DateTime.Now;}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ var\ forexData\ =\ PullForexData(pullTime);}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ var\ polygonOracleData\ =\ PullPolygonOracleData(pullTime);}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ var\ oandaData\ =\ PullOandaData(pullTime);}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ var\ binanceData\ =\ PullBinanceData(pullTime);}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ finalSpotList.AddRange(polygonOracleData);}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ finalSpotList.AddRange(forexData);}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ finalSpotList.AddRange(oandaData);}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ finalSpotList.AddRange(binanceData);}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \textcolor{comment}{//group\ by\ assetcode,\ take\ only\ groups\ >\ 0\ count}}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ var\ assetGroups\ =\ finalSpotList.GroupBy(bs\ =>\ bs.AssetCode).Where(grp\ =>\ grp.Count()\ >\ 1);}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (var\ grp\ \textcolor{keywordflow}{in}\ assetGroups)}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (grp.Any(bs\ =>\ bs.Spot\ ==\ 0)\ \&\&\ !grp.All(bs\ =>\ bs.Spot\ ==\ 0))}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//group\ has\ some\ 0's\ but\ not\ all\ -\/\ remove\ 0's}}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (var\ bs\ \textcolor{keywordflow}{in}\ grp.Where(bs\ =>\ bs.Spot\ ==\ 0))}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ finalSpotList.Remove(bs);}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!grp.All(bs\ =>\ bs.Spot\ ==\ 0))}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//group\ has\ all\ 0's\ -\/\ remove\ all\ but\ one\ for\ placeholder}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (var\ bs\ \textcolor{keywordflow}{in}\ grp.Where(bs\ =>\ bs.Spot\ ==\ 0).Take(grp.Count()\ -\/\ 1))}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ finalSpotList.Remove(bs);}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (\mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_base_spot}{BaseSpot}}\ bs\ \textcolor{keywordflow}{in}\ finalSpotList.Where(bs\ =>\ bs.Spot\ ==\ 0))}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ RecyclePreviousSpot(bs);}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \textcolor{comment}{//convert\ all\ usd\ and\ btc\ to\ aud\ excluding\ aud\ itself\ }}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ audusd\ =\ Convert.ToDouble(finalSpotList.FirstOrDefault(bs\ =>\ bs.AssetCode\ ==\ \textcolor{stringliteral}{"{}AUD"{}}\ \&\&\ bs.Source\ ==\ \_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_ac56f44c706202b85f9a949eefd802a4b}{PolygonOracleSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_polygonoraclesettings_a9cce11d1062ce85664de5bf6bb1da49e}{SourceName}})?.Spot);}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (audusd\ ==\ 0)}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ var\ fallbackAUD\ =\ finalSpotList.FirstOrDefault(bs\ =>\ bs.AssetCode\ ==\ \textcolor{stringliteral}{"{}AUD"{}});}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ audusd\ =\ Convert.ToDouble(fallbackAUD?.Spot);}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(fallbackAUD\ ==\ \textcolor{keyword}{null})}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_logService.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_a46dc9bf58bc9605c7e17dfee38b94354}{LogError}}(\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service}{LogService}}.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_ac2b08e94307168cb702773d148d166ba}{LogSources}}.SpotHelper,\ \$\textcolor{stringliteral}{"{}polygon\ oracle\ AUD\ unavailable,\ NO\ FALLBACK\ SOURCE\ AVAILABLE,\ price\ \$\{audusd\}"{}});}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_logService.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_a5c2a67dbd8beb6f821c46b8d052d59ea}{LogInformation}}(\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service}{LogService}}.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_ac2b08e94307168cb702773d148d166ba}{LogSources}}.SpotHelper,\ \$\textcolor{stringliteral}{"{}polygon\ oracle\ AUD\ unavailable,\ falling\ back\ to\ \{fallbackAUD.Source\ \},\ price\ \$\{audusd\}"{}});}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ btcaud\ =\ Convert.ToDouble(finalSpotList.FirstOrDefault(bs\ =>\ bs.AssetCode\ ==\ \textcolor{stringliteral}{"{}BTC"{}}\ \&\&\ bs.PairCode\ ==\ \textcolor{stringliteral}{"{}AUD"{}})?.Spot);}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (btcaud\ ==\ 0\ \&\&\ audusd\ >\ 0)}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ btcusd\ =\ Convert.ToDouble(finalSpotList.FirstOrDefault(bs\ =>\ bs.AssetCode\ ==\ \textcolor{stringliteral}{"{}BTC"{}}\ \&\&\ bs.PairCode\ ==\ \textcolor{stringliteral}{"{}USD"{}})?.Spot);}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ btcaud\ =\ btcusd\ /\ audusd;}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//comment\ out\ while\ using\ USD\ as\ default\ market}}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\_logService.LogError(LogService.LogSources.SpotHelper,\ \$"{}binance\ feed\ BTCAUD\ unavailable,\ falling\ back\ to\ BTCUSD"{});}}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (audusd\ >\ 0)}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//convert\ usd\ values\ to\ aud\ except\ audusd}}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (var\ bs\ \textcolor{keywordflow}{in}\ finalSpotList.Where(bs\ =>\ bs.PairCode\ ==\ \textcolor{stringliteral}{"{}USD"{}}\ \&\&\ !(bs.AssetCode\ ==\ \textcolor{stringliteral}{"{}AUD"{}})))}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bs.Spot\ =\ bs.Spot\ /\ audusd;}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bs.PairCode\ =\ \textcolor{stringliteral}{"{}AUD"{}};}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_logService.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_a6be037b34888bbcf6b47dca8eef472de}{LogDebug}}(\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service}{LogService}}.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_ac2b08e94307168cb702773d148d166ba}{LogSources}}.SpotHelper,\ \$\textcolor{stringliteral}{"{}converted\ \{bs.AssetCode\}\ from\ USD\ to\ AUD"{}});}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \_iapiService.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_internal_a_p_i_service_aeffeb1d3d59aeeab65dfe72691d21600}{SendEmail}}(\textcolor{keyword}{new}\ \mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_d_t_o_1_1_internal_a_p_i_1_1_email_post}{EmailPost}}()}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EmailFrom\ =\ \_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_af39dc0933cd608b26e7bc4f82951d356}{GeneralSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_generalsettings_ac0a0b89d2e7cf7f820e5663a1a4cffbf}{NotificationEmailFrom}},}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EmailTo\ =\ \_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_af39dc0933cd608b26e7bc4f82951d356}{GeneralSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_generalsettings_a25434a5471214771ae507f7152073898}{NotificationEmailTo}},}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NameFrom\ =\ \_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_af39dc0933cd608b26e7bc4f82951d356}{GeneralSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_generalsettings_a082a8e92b97a7d83196f1d0056241042}{NotificationEmailName}},}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Subject\ =\ \textcolor{stringliteral}{"{}Error\ getting\ AUD\ from\ price\ feeds"{}},}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ HTMLBody\ =\ \$\textcolor{stringliteral}{"{}Task\ API\ was\ unable\ to\ find\ the\ AUD\ price\ in\ this\ round"{}}}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ \_logService.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_a46dc9bf58bc9605c7e17dfee38b94354}{LogError}}(\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service}{LogService}}.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_ac2b08e94307168cb702773d148d166ba}{LogSources}}.SpotHelper,\ \$\textcolor{stringliteral}{"{}AUD\ not\ found,\ unable\ to\ convert\ USD\ and\ BTC\ values"{}});}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (btcaud\ >\ 0)}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//convert\ btc\ values\ to\ aud}}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (var\ bs\ \textcolor{keywordflow}{in}\ finalSpotList.Where(bs\ =>\ bs.PairCode\ ==\ \textcolor{stringliteral}{"{}BTC"{}}))}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bs.Spot\ =\ bs.Spot\ *\ btcaud;}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bs.PairCode\ =\ \textcolor{stringliteral}{"{}AUD"{}};}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_logService.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_a6be037b34888bbcf6b47dca8eef472de}{LogDebug}}(\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service}{LogService}}.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_ac2b08e94307168cb702773d148d166ba}{LogSources}}.SpotHelper,\ \$\textcolor{stringliteral}{"{}converted\ \{bs.AssetCode\}\ from\ BTC\ to\ AUD"{}});}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{comment}{//compare\ metal\ duplcates\ against\ thresholds}}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ var\ compareGroups\ =\ finalSpotList.GroupBy(bs\ =>\ bs.AssetCode).Where(grp\ =>\ grp.Count()\ >\ 1);}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \textcolor{comment}{//XAU}}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ var\ grpXAU\ =\ compareGroups.FirstOrDefault(grp\ =>\ grp.Key\ ==\textcolor{stringliteral}{"{}XAU"{}});}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (grpXAU\ !=\ \textcolor{keyword}{null})}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ var\ variations\ =\ \textcolor{keyword}{new}\ List<(string\ description,\ double\ variation)>();}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//primary\ value\ to\ compare\ all\ others\ against\ should\ be\ polygon\ oracle,\ otherwise\ choose\ first}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}?\ primaryValue\ =\ grpXAU.FirstOrDefault(bs\ =>\ bs.Source==\_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_ac56f44c706202b85f9a949eefd802a4b}{PolygonOracleSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_polygonoraclesettings_a9cce11d1062ce85664de5bf6bb1da49e}{SourceName}})?.Spot\ ??}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ grpXAU.FirstOrDefault()?.Spot;}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (primaryValue\ !=\ \textcolor{keyword}{null})}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (var\ bs\ \textcolor{keywordflow}{in}\ grpXAU)}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\%\ difference\ calculation}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ variations.Add((\$\textcolor{stringliteral}{"{}AssetCode:\ \{bs.AssetCode\}\ Source:\ \{bs.Source\}\ Primary\ Value:\ \{primaryValue.ToString()\}\ Comparison\ Value:\ \{bs.Spot\}"{}},\ ((\textcolor{keywordtype}{double})primaryValue\ -\/\ bs.Spot)\ /\ (((\textcolor{keywordtype}{double})primaryValue\ +\ bs.Spot)\ /\ 2)\ *\ 100));}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (variations.Any(var\ =>\ var.variation\ >\ \_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_abc5a23cce7a98ce3cd109ecb1c3122ae}{SpotFeedSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_spotfeedsettings_abce48cfdd32d7c339d09d27193deb7c4}{XAUFeedVariationThresholdPercent}}\ ||\ var.variation\ <\ -\/\_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_abc5a23cce7a98ce3cd109ecb1c3122ae}{SpotFeedSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_spotfeedsettings_abce48cfdd32d7c339d09d27193deb7c4}{XAUFeedVariationThresholdPercent}}))}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_logService.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_a46dc9bf58bc9605c7e17dfee38b94354}{LogError}}(\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service}{LogService}}.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_ac2b08e94307168cb702773d148d166ba}{LogSources}}.SpotHelper,\ \textcolor{stringliteral}{"{}XAU\ feeds\ are\ outside\ variation\ threshold"{}},\ variations);}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \textcolor{comment}{//XAG}}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ var\ grpXAG\ =\ compareGroups.FirstOrDefault(grp\ =>\ grp.Key\ ==\ \textcolor{stringliteral}{"{}XAG"{}});}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (grpXAG\ !=\ \textcolor{keyword}{null})}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ var\ variations\ =\ \textcolor{keyword}{new}\ List<(string\ description,\ double\ variation)>();}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//primary\ value\ to\ compare\ all\ others\ against\ should\ be\ polygon\ oracle,\ otherwise\ choose\ first}}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}?\ primaryValue\ =\ grpXAG.FirstOrDefault(bs\ =>\ bs.Source\ ==\ \_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_ac56f44c706202b85f9a949eefd802a4b}{PolygonOracleSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_polygonoraclesettings_a9cce11d1062ce85664de5bf6bb1da49e}{SourceName}})?.Spot\ ??}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ grpXAG.FirstOrDefault()?.Spot;}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (primaryValue\ !=\ \textcolor{keyword}{null})}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (var\ bs\ \textcolor{keywordflow}{in}\ grpXAG)}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\%\ difference\ calculation}}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ variations.Add((\$\textcolor{stringliteral}{"{}AssetCode:\ \{bs.AssetCode\}\ Source:\ \{bs.Source\}\ Primary\ Value:\ \{primaryValue.ToString()\}\ Comparison\ Value:\ \{bs.Spot\}"{}},\ ((\textcolor{keywordtype}{double})primaryValue\ -\/\ bs.Spot)\ /\ (((\textcolor{keywordtype}{double})primaryValue\ +\ bs.Spot)\ /\ 2)\ *\ 100));}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (variations.Any(var\ =>\ var.variation\ >\ \_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_abc5a23cce7a98ce3cd109ecb1c3122ae}{SpotFeedSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_spotfeedsettings_acf22a3188f3d0473175cbd5ac65dd2b9}{XAGFeedVariationThresholdPercent}}\ ||\ var.variation\ <\ -\/\_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_abc5a23cce7a98ce3cd109ecb1c3122ae}{SpotFeedSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_spotfeedsettings_acf22a3188f3d0473175cbd5ac65dd2b9}{XAGFeedVariationThresholdPercent}}))}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_logService.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_a46dc9bf58bc9605c7e17dfee38b94354}{LogError}}(\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service}{LogService}}.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_ac2b08e94307168cb702773d148d166ba}{LogSources}}.SpotHelper,\ \textcolor{stringliteral}{"{}XAG\ feeds\ are\ outside\ variation\ threshold"{}},\ variations);}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \textcolor{comment}{//AUD}}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ var\ grpAUD\ =\ compareGroups.FirstOrDefault(grp\ =>\ grp.Key\ ==\ \textcolor{stringliteral}{"{}AUD"{}});}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (grpAUD\ !=\ \textcolor{keyword}{null})}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ var\ variations\ =\ \textcolor{keyword}{new}\ List<(string\ description,\ double\ variation)>();}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//primary\ value\ to\ compare\ all\ others\ against\ should\ be\ polygon\ oracle,\ otherwise\ choose\ first}}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}?\ primaryValue\ =\ grpAUD.FirstOrDefault(bs\ =>\ bs.Source\ ==\ \_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_ac56f44c706202b85f9a949eefd802a4b}{PolygonOracleSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_polygonoraclesettings_a9cce11d1062ce85664de5bf6bb1da49e}{SourceName}})?.Spot\ ??}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ grpAUD.FirstOrDefault()?.Spot;}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (primaryValue\ !=\ \textcolor{keyword}{null})}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (var\ bs\ \textcolor{keywordflow}{in}\ grpAUD)}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\%\ difference\ calculation}}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ variations.Add((\$\textcolor{stringliteral}{"{}AssetCode:\ \{bs.AssetCode\}\ Source:\ \{bs.Source\}\ Primary\ Value:\ \{primaryValue.ToString()\}\ Comparison\ Value:\ \{bs.Spot\}"{}},\ ((\textcolor{keywordtype}{double})primaryValue\ -\/\ bs.Spot)\ /\ (((\textcolor{keywordtype}{double})primaryValue\ +\ bs.Spot)\ /\ 2)\ *\ 100));}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (variations.Any(var\ =>\ var.variation\ >\ \_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_abc5a23cce7a98ce3cd109ecb1c3122ae}{SpotFeedSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_spotfeedsettings_abe038aab4e92b88aab47caf734aa8a3e}{AUDFeedVariationThresholdPercent}}\ ||\ var.variation\ <\ -\/\_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_abc5a23cce7a98ce3cd109ecb1c3122ae}{SpotFeedSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_spotfeedsettings_abe038aab4e92b88aab47caf734aa8a3e}{AUDFeedVariationThresholdPercent}}))}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_logService.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_a46dc9bf58bc9605c7e17dfee38b94354}{LogError}}(\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service}{LogService}}.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_ac2b08e94307168cb702773d148d166ba}{LogSources}}.SpotHelper,\ \textcolor{stringliteral}{"{}AUD\ feeds\ are\ outside\ variation\ threshold"{}},\ variations);}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \textcolor{comment}{//remove\ redundant/duplicate\ assets\ selecting\ preferred\ source\ or\ highest\ price}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (var\ grp\ \textcolor{keywordflow}{in}\ compareGroups)}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//polygon\ oracle\ is\ preferred\ source}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (grp.Any(bs\ =>\ bs.Source\ ==\ \_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_ac56f44c706202b85f9a949eefd802a4b}{PolygonOracleSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_polygonoraclesettings_a9cce11d1062ce85664de5bf6bb1da49e}{SourceName}}))}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//group\ has\ preferred\ source\ -\/\ remove\ others}}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ finalSpotList\ =\ finalSpotList.Except(grp.Where(bs\ =>\ bs.Source\ !=\ \_settings.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_ac56f44c706202b85f9a949eefd802a4b}{PolygonOracleSettings}}.\mbox{\hyperlink{class_task_a_p_i_1_1_helpers_1_1_settings_1_1_task_a_p_i_settings_1_1_polygonoraclesettings_a9cce11d1062ce85664de5bf6bb1da49e}{SourceName}})).ToList();}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//group\ has\ no\ preferred\ source\ -\/\ remove\ all\ but\ most\ expensive}}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ finalSpotList\ =\ finalSpotList.Except(grp.Where(bs\ =>\ bs\ !=\ grp.OrderByDescending(bs\ =>\ bs.Spot).First())).ToList();}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ GenerateSpecialData(pullTime,\ finalSpotList);}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \_context.\mbox{\hyperlink{class_task_a_p_i_1_1_contexts_1_1_priceapp_context_a5e7d6eb59fabb7c28af0d9a97551a83d}{BaseSpots}}.AddRange(finalSpotList);}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \_context.SaveChanges();}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ TrimSpotData();}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ finalSpotList;}
\DoxyCodeLine{00259\ \ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a7b75f44b3310036d4de7f0f2956bbac1_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a7b75f44b3310036d4de7f0f2956bbac1_icgraph}
\end{center}
\end{figure}
\Hypertarget{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a6b975ced6fddc4826a8950c8a250b926}\label{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a6b975ced6fddc4826a8950c8a250b926} 
\index{TaskAPI.Helpers.SpotHelper@{TaskAPI.Helpers.SpotHelper}!SaveDailySpot@{SaveDailySpot}}
\index{SaveDailySpot@{SaveDailySpot}!TaskAPI.Helpers.SpotHelper@{TaskAPI.Helpers.SpotHelper}}
\doxysubsubsection{\texorpdfstring{SaveDailySpot()}{SaveDailySpot()}}
{\footnotesize\ttfamily bool? object Result Task\+API.\+Helpers.\+Spot\+Helper.\+Save\+Daily\+Spot (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00698\ \ \ \ \ \{}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ isDebug\ =\ \_env.IsDevelopment()\ ||\ \_env.IsStaging();}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ Year\ =\ DateTime.Now.Year;}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ Month\ =\ DateTime.Now.Month;}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ Day\ =\ DateTime.Now.Day;}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//5\ mins\ before\ is\ ok,\ allow\ 1\ hr\ after\ in\ case\ retries\ are\ required}}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ var\ WindowOpen\ =\ \textcolor{keyword}{new}\ DateTime(Year,\ Month,\ Day,\ 15,\ 55,\ 0);}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \ \ \ \ var\ WindowClose\ =\ \textcolor{keyword}{new}\ DateTime(Year,\ Month,\ Day,\ 16,\ 05,\ 0);}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!isDebug\ \&\&\ !(DateTime.Now\ >\ WindowOpen\ \&\ DateTime.Now\ <\ WindowClose))}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keyword}{false},\ \textcolor{keyword}{new}\ \{\ success\ =\ \textcolor{keyword}{false},\ message\ =\ \textcolor{stringliteral}{"{}request\ does\ not\ fall\ within\ daily\ save\ time\ window"{}}\ \});}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//check\ if\ done\ today\ already}}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!isDebug\ \&\&\ \_context.\mbox{\hyperlink{class_task_a_p_i_1_1_contexts_1_1_priceapp_context_a0a63b303899246b496a42f08da57bd43}{DailyCloses}}.Where(dc\ =>\ dc.Year\ ==\ Year\ \&\&\ dc.Month\ ==\ Month\ \&\&\ dc.Day\ ==\ Day).Count()\ >\ 0)\ }
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keyword}{false},\ \textcolor{keyword}{new}\ \{\ success\ =\ \textcolor{keyword}{false},\ message\ =\ \textcolor{stringliteral}{"{}daily\ closes\ already\ completed\ for\ today"{}},\ Data\ =\ \_context.\mbox{\hyperlink{class_task_a_p_i_1_1_contexts_1_1_priceapp_context_a0a63b303899246b496a42f08da57bd43}{DailyCloses}}.Where(dc\ =>\ dc.Year\ ==\ Year\ \&\&\ dc.Month\ ==\ Month\ \&\&\ dc.Day\ ==\ Day).ToList()\ \});}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//get\ current\ asset\ list\ from\ priceapp}}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ \ \ \ \ var\ assetList\ =\ \_iapiService.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_internal_a_p_i_service_a7e3600841f53749e6c915ace609dfa11}{PriceappAssets}}();}
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (assetList\ ==\ \textcolor{keyword}{null}\ ||\ assetList.Count\ ==\ 0)}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keyword}{true},\ \textcolor{keyword}{new}\ \{\ success\ =\ \textcolor{keyword}{false},\ message\ =\ \textcolor{stringliteral}{"{}asset\ list\ from\ priceapp\ was\ null"{}}\ \});}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \ \ \ \ List<DailyClose>\ dailyCloses\ =\ \textcolor{keyword}{new}\ List<DailyClose>();}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//create\ a\ daily\ close\ for\ AUD}}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \ \ \ \ var\ first\ =\ assetList.FirstOrDefault();}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \ \ \ \ var\ audusd\ =\ Math.Truncate(10000\ *\ first.audusd)\ /\ 10000;}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_daily_close}{DailyClose}}\ AUDClose\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_daily_close}{DailyClose}}() }
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Year\ =\ Year,}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Month\ =\ Month,}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Day\ =\ Day,}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ AssetCode\ =\ \textcolor{stringliteral}{"{}AUD"{}},}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PairCode\ =\ \textcolor{stringliteral}{"{}USD"{}},}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Per\ =\ \textcolor{stringliteral}{"{}\$"{}},}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Buy\ =\ audusd,}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Spot\ =\ audusd,}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Sell\ =\ audusd}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ \ \ \ \ dailyCloses.Add(AUDClose);}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//create\ daily\ close\ for\ all\ else}}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (\mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_d_t_o_1_1_internal_a_p_i_1_1_priceapp_asset}{PriceappAsset}}\ x\ \textcolor{keywordflow}{in}\ assetList)}
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (x.\mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_d_t_o_1_1_internal_a_p_i_1_1_priceapp_asset_acb2a7c7f2ddd8fa7c579322de264f035}{assetCode}}\ ==\ \textcolor{stringliteral}{"{}XX1"{}})}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ all\ assets\ from\ internal\ api\ are\ AUD}}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_daily_close}{DailyClose}}\ dc\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_daily_close}{DailyClose}}() }
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Year\ =\ Year,}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Month\ =\ Month,}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Day\ =\ Day,}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ AssetCode\ =\ x.\mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_d_t_o_1_1_internal_a_p_i_1_1_priceapp_asset_acb2a7c7f2ddd8fa7c579322de264f035}{assetCode}},}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PairCode\ =\ \textcolor{stringliteral}{"{}AUD"{}},}
\DoxyCodeLine{00749\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Per\ =\ x.\mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_d_t_o_1_1_internal_a_p_i_1_1_priceapp_asset_a74613f64ecc58f8cd0d4496e02d6fe30}{spotUnit}}?.\mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_d_t_o_1_1_internal_a_p_i_1_1_priceapp_asset_1_1_spotunit_a362ee02b811e851f1a58a49e5d4fac46}{unitName}}\ ??\ \textcolor{stringliteral}{"{}"{}}\ ,}
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Buy\ =\ x.\mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_d_t_o_1_1_internal_a_p_i_1_1_priceapp_asset_a4bc64e34a3e1a3037fe6c618bef375f9}{environmentBuy}},}
\DoxyCodeLine{00751\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Spot\ =\ x.\mbox{\hyperlink{class_task_a_p_i_1_1_models_1_1_d_t_o_1_1_internal_a_p_i_1_1_priceapp_asset_a6843f4b4444d004a9e86462e1615a481}{environmentSpot}},}
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Sell\ =\ x.environmentSell}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dailyCloses.Add(dc);}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \ \ \ \ \_context.\mbox{\hyperlink{class_task_a_p_i_1_1_contexts_1_1_priceapp_context_a0a63b303899246b496a42f08da57bd43}{DailyCloses}}.AddRange(dailyCloses);}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ \ \ \_context.SaveChanges();}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ \ \ \ \ var\ exportResult\ =\ ExportChartData();}
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (exportResult.Error,\ \textcolor{keyword}{new}\ \{\ SaveDailtySpot\ =\ dailyCloses,\ ExportChartData\ =\ exportResult.Result\ \});}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00761\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{catch}\ (Exception\ ex)}
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ \ \ \ \ \_logService.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_a46dc9bf58bc9605c7e17dfee38b94354}{LogError}}(\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service}{LogService}}.\mbox{\hyperlink{class_task_a_p_i_1_1_services_1_1_log_service_ac2b08e94307168cb702773d148d166ba}{LogSources}}.SpotHelper,\ \textcolor{stringliteral}{"{}exception\ saving\ daily\ spot"{}},\ ex.ToString());}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keyword}{true},\ ex.ToString());}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00766\ \ \ \ \ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a6b975ced6fddc4826a8950c8a250b926_icgraph}
\end{center}
\end{figure}


\doxysubsection{Member Data Documentation}
\Hypertarget{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a1d8458171af3cac5a7fc1fc1f35de115}\label{class_task_a_p_i_1_1_helpers_1_1_spot_helper_a1d8458171af3cac5a7fc1fc1f35de115} 
\index{TaskAPI.Helpers.SpotHelper@{TaskAPI.Helpers.SpotHelper}!Error@{Error}}
\index{Error@{Error}!TaskAPI.Helpers.SpotHelper@{TaskAPI.Helpers.SpotHelper}}
\doxysubsubsection{\texorpdfstring{Error}{Error}}
{\footnotesize\ttfamily bool Task\+API.\+Helpers.\+Spot\+Helper.\+Error}



Saves daily spot data to the database and exports chart data. 

Exports chart data to JSON files for AUD and USD currencies.

\begin{DoxyReturn}{Returns}
A tuple indicating whether an error occurred during the process and providing details about the result of the operation. 
\end{DoxyReturn}


This method retrieves asset data from Priceapp, creates daily close records for each asset, saves them to the database, and exports chart data. It ensures that the operation falls within a specified time window and checks whether daily closes have already been completed for the current day. 

\begin{DoxyReturn}{Returns}
A tuple indicating whether an error occurred during the export process and providing a message about the result. 
\end{DoxyReturn}


This method retrieves chart data from Internal API, groups it by metal, and orders it according to a specified mapping. Then, it converts the chart data to AUD and USD currencies, saves them as JSON files, and logs the export process. 

The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
C\+:/\+Users/\+STRIDER/source/repos/\+Task\+API/\+Helpers/\mbox{\hyperlink{_spot_helper_8cs}{Spot\+Helper.\+cs}}\end{DoxyCompactItemize}
